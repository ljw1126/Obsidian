- 📚리뷰 도서 : [자바 최적화 2판](https://www.hanbit.co.kr/store/books/look.php?p_code=B9520608962)

소프트웨어 개발자가 더 잘하기 위해 하드웨어에도 관심을 가지기 시작하는 걸 **기계적 관심**이라고 했던거 같다.
- 책을 읽으면서 하드웨어적인 영역도 다루다보니 수준이 높다.. 
- 지금 당장 읽기 힘든 사람이라면, 훓어보고 키워드를 정리하는 것만으로 단편적으로 도움 받을 수 있찌 않을까 싶다 
- 단일 자바 가상 머신 환경에서 클라우드, 분산 환경, 배포, 모니터링(관측성)

성능 최적화 관련해서 개인적으로 "하지마라, 아직 하지마라(YAGNI)"가 생각난다.

자바 최적화이기때문에 JVM, 배포, 관리와 관련된 설명이 주를 이룸
- 이때 스프링, Docker(Dockerfile, compose),쿠버네티스, 클라우드, 배포 전략에 대해 간단히 살펴본다

성능 최적화가 필요하지 않은 시점에서 최적화를 고민하는 것은 오버엔지니어링 !
- 그리고 인터넷에 있는 잡글을 믿으면 안됨
- `1.1  잘못된 자바 성능 최적화 방법`에서 마법의 은탄환은 존재하지 않는다는 것을 언급(p31)

p34 성능 튜닝의 단계 
- 도식화하면 좋을 듯하다 

p39 성능 지표에 대해 설명할 때 상하관계가 인상깊다 (성능저하 부분)

p40 `1.5 성능 그래프 읽기`
> 그럴듯해보이지만, 이게 처음이자 마지막이 아닌가 싶다. 뒤로 갈수록 이론적인 내용이 훨씬 많이 차지하고 있다..

p45 1장 요약 
자바 성능의 개념에 대한 논의를 시작
효과적인 성능 분석에서 사용하는 기본 용어나 관측 가능한 지표들을 소개
성능 테스트 결과에서 자주 관찰되는 몇가지 일반적인 사례도 다루고, 클라우드 시스템에서 발생할 수 있는 추가적인 문제의 기초적인 개념을 소개함 

2장에서는 테스트에 대한 내용을 다룸 
- 유형별 정의 용의하네 


---
p30 (`도서 하단 목차 기준`)

개정판에서는 네 가지 주요 목표를 제공 
1. 단일 자바 가상 머신에서 실행되는 애플리케이션 코드의 성능에 대한 심층 분석
2. 자바 가상 머신 내부 구조에 대한 논의 
3. 현대 클라우드 스택이 자바/자바 가상 머신 애플리케이션과 상호 작용하는 방식에 대한 세부 사항
4. 클라우드 환경에서 클러스터로 실행되는 자바 애플리케이션의 동작에 대한 첫 번째 고착


**1.1 잘못된 자바 성능 최적화 방법**
'모든 코드를 하나의 메서드에 몰아 넣으라'는 조언을 따른 코드는 이제 현대의 JIT 컴파일러와 매우 부조화여서 오히려 성능 저하를 초래합니다.

p31

이 잘못된 조언을 따른 애플리케이션의 성능이 얼마나 손상되었는지는 알 수 없지만, 이 사례는 성능 문제에 정량적이고 검증할 수 있는 접근 방식을 사용하지 않을 때의 위험성을 잘 보여줍니다. 또한, 인터넷에서 잡한 모든 내용을 맹신해서는 안된다는 교훈을 제공하는 좋은 사례이기도 합니다. 

다음과 같은 것은 존재하지 않습니다. 
- 자바 가상 머신 성능을 획기적으로 높여주는 '마법 같은' 스위치
- 자바를 더 빠르게 만드는 '팁과 트릭'
- 숨겨진 비밀 알고리즘 


**1.2 자바 성능 개요**
대표적인 예가 메모리 관리입니다. 자바 가상 머신은 플러그형 **가비지 컬렉션** 서브 시스템을 통해 자동으로 메모리를 관리하므로, 프로그래머는 메모리를 수동으로 추적할 필요가 x

자바 성능 데이터의 특성상 통계적으로 정교한 접근이 필요하며, 단순한 기법을 자바/자바 가상 머신 애플리케이션에 적용하면 잘못된 결과를 자주 산출합니다.


**1.3 실증 과학으로서의 기능**

가장 먼저 이해해야 할 핵심 개념은 자바 가상 머신이 빠른 플랫폼이라는 점이다.

p34
다시 말해 성능은 실증 과학입니다. 성능 튜닝은 다음과 같은 단계를 거쳐 진행됩니다. 
1. 원하는 결과를 정의합니다 
2. 기존 시스템을 측정합니다 
3. 요구사항을 충족하기 위해 필요한 작업을 결정합니다 
4. 개선 작업을 수행합니다 
5. 다시 테스트합니다
6. 목표가 달성되었는지 확인합니다.

> 1장에서는 단일 자바 가성 머신에 적용되는 성능 튜닝 기법을 다룸

p35

**1.4 성능을 위한 분류 체계**
성능을 관측할 수 있는 지표는 다음과 같습니다 
- 처리량 (throughput)
- 효율성 (effciency)
- 지연 시간 (latency)
- 확장성 (scablity)
- 수용량 (capacity)
- 성능 저하 
- 활용도

**1.4.1 처리량**
- 시스템이나 서브 시스템이 수행할 수 있는 작업의 속도를 나타내는 지표
- 예를 들어, 초당 시스템이 처리할 수 있는 거래 수를 측정할 수 있습니다
	- 성능 지표는 때때로 배관과 같은 비유로 설명됩니다 
	- 물 파이프가 초당 100리터의 물을 생성할 수 있다면, 1초 동안 생성된 물의 양(100리터)이 처리량입니다. 이 값은 물의 속도와 파이프의 단면적에 따라 결정됩니다.

**1.4.2 지연 시간**
- S/W에서는 지연시간이 보통 시작에서 끝까지 걸리는 시간으로 정의되며, 단일 거래를 처리하고 결과를 확인하는데 걸리는 시간을 의미합니다.
- 작업 부하에 따라 다를 수 있으므로, 작업 부하가 증가함에 따라 지연시간을 나타내는 그래프를 생성하는 것이 일반적입니다.

**1.4.3 수용량**
- 시스템이 보유한 병렬 처리 작업량을 의미하며, 시스템에서 동시에 진행할 수 있는 작업 단위(ex. 거래)수를 나타냅니다.
- 예를 들어, 파이프의 시작 부분에 큰 저수조가 있다면 수용량이 증가할 수 있지만 전체 처리량에는 영향을 주지 않을 수 있습니다. 
- 반대로 매우 좁은 입구를 가진 파이프는 수용량이 적을 수 있습니다.


**1.4.4 활용도**
- 성능 분석의 가장 일반적인 작업은 시스템 리소스의 효율적인 사용을 달성하는 것입니다. (..)
- CPU뿐만 아니라 네트워크, 메모리, 때로는 저장소 I/O 서브시스템과 같은 다른 자원 유형도 클라우드 네이티브 애플리케이션에서 관리할 중요한 자원이 되어가고 있습니다. 
- 많은 애플리케이션에서 CPU보다 더 많은 메모리가 낭비되며, 많은 마이크로 서비스에서 네트워크 트래픽이 진정한 병목 현상이 되고 있습니다. 
- 예를 들어, 파이프의 입구가 좁을 경우 파이프 대부분이 높은 처리량을 가지더라도 입구 제한 때문에 전체 활용도가 낮을 수 있습니다. 즉, 파이프 내 물 수준이 낮게 유지됨)

**1.4.5 효율성**
- 동일한 처리량을 생산하는 데 더 많은 자원이 필요하다면, 이는 덜 효율적이라는 유용한 정의 중 하나가 되기 때문입니다. 

**1.4.6 확장성**
- 자원을 추가할 때 처리량이 어떻게 변하는지를 기준으로 정의하는 것이 유용함
- 이상적인 시스템 확장성은 자원이 증가하면 처리량이 정확히 비례하여 증가하는 것입니다.
- 시스템 확장성은 여러 요인에 의존하며, 일반적으로 단순한 선형 관계가 아닙니다 
- 일부 자원 범위에서는 시스템이 거의 선형적으로 확장되지만, 부하가 높아지면 완벽한 확장을 방해하는 한계를 마주하는 경우가 흔합니다. 

**1.4.7 성능 저하**
- 예를 들어, 일반적으로 시스템의 부하가 증가하면 활용도가 변하게 됩니다. 그러나 시스템이 낮은 활용 상태라면 부하를 증가시키더라도 활용도가 눈에 띄게 증가하지 않을 수 있습니다. 
- 반대로 시스템이 이미 과부하 상태라면 부하 증가의 영향이 다른 관측 지표에 나타날 수 있습니다. 
- 또 다른 예로, 확장성과 성능 저하는 둘다 부하가 증가함에 따라 시스템의 동작이 어떻게 변하는지를 나타냅니다. 확장성의 경우, 부하가 증가할 때 자원도 함께 추가되며, 시스템이 이러한 자원을 활용할 수 있는지가 핵심입니다. 
- 반면에, 부하는 증가하나 추가 자원이 제공되지 않으면 일부 성능 지표(ex. 지연시간)의 저하가 예상됩니다.


**1.5 성능 그래프 읽기**

> [!note] 성능 엘보(performance elbow)
> 증가하는 부하 아래에서 성능 (이 경우, 지연 시간)의 갑작스럽고 예기치 않게 저하되는 현상

> [!note] 암달의 법칙
> 이 법칙이 제시하는 확장성의 근본적인 제약을 그래프로 나타낸 것으로, 작업에 할당된 프로세서 수를 증가시킬 때 성능 향상 비율이 점점 감소하는 패턴을 보인다 



p42
sw 시스템 성능 그래프에서 자주 다루는 또 다른 주제는 메모리 활용도 (memory utilization) 입니다. 
- JVM의 GC 하위 시스템에 사용된 기술은 자연스럽게 스트레스 받지 않는 정상적인 애플리케이션에서 메모리 사용량이 '톱니형'패턴으로 나타나게 됩니다. 
- 이는 이클립스 어답티움에서 제공하는 JDK 미션 컨트롤(JMC) 도구의 스크린샷을 보여줍니다. (생략)

자바 가상 머신의 주요 성능 지표 중 하나는 **할당 속도(allocation rate)** 입니다 
- 할당 한계에 도달한 상태와 시스템에 자원 누수가 발생한 상태는 다른 문제라는 것입니다. 


p44
**1.6 클라우드 시스템의 성능**
분산 시스템 운영자는 다음과 같은 사항을 고려해야 합니다.
- 클러스터 내에서 작업이 어떻게 분배되는가?
- (..)

또한 클라우드 시스템에서는 단일 자바 가상 머신 환경과는 다른 두 가지 중요한 측면이 존재합니다. 
이러한 차이점은 .. 초보자들에게 처음에 명확하게 드러나지 않을 수 있습니다. 

1. 클라우드에서 배포 가능한 코드의 단위가 애플리케이션의 자바 가상 머신 프로세스가 아니라 **컨테이너**라는 점입니다.
	1. 분산 배포 환경을 기준으로 설명하는 듯 하다
2. 서비스에서 클라우드 제공업체르 사용하는 방식에 따라 효율성이나 활용도가 서비스 운영 비용에 직접적인 영향을 미친다는 점입니다. 

> 과거에는 팀이 데이터 센터의 특정 구역(일반적으로 **케이지**라 부름)에 실제 물리 서버를 소유하는 경우가 많았습니다. 이 서버 구매는 **자본 지출**을 의미하며, 자산으로 관리되었습니다. 
> 
> 반면 클라우드 서비스 회사가 소유한 머신의 시간을 임대하게 됩니다. 이는 **운영 비용**에 해당하며, 서비스의 비용(혹은 부채)으로 관리됩니다.

---
## 2장 성능 테스트 방법론 

**2.1 성능 테스트 종류**
성능 테스트는 종종 잘못된 이유로 수행되거나, 부실하게 진행됩니다. 
- 이유는 다양하지만, 대개는 성능 분석의 본질을 제대로 이해하지 못했거나, '아무것도 하지 않는 것보다는, 무언가를 하는 것이 낫다'는 믿음으로부터 시작됩니다.😂
- 이러한 믿음은 위험한 반쪽짜리 진실에 불과하다는 것을 이 책을 통해 알게 될 것입니다. 

흔히 저지르는 실수 중 하나는 구체적인 사항을 고려하지 않은 채 단순히 성능 테스트라는 용어를 일반적으로 사용하는 것입니다. 

p48
가장 일반적인 테스트 유형들과 각 유형의 예시 질문은 다음과 같습니다. 
- 지연 테스트: 시작부터 끝까지의 트랜잭션 시간은 얼마나 걸립니까?
- 처리량 테스트: 현재 시스템 용량으로 몇 개의 동시 거래를 처리할 수 있습니까?
- 스트레스 테스트: 시스템의 한계쩜은 무엇인가요?
- 부하 테스트: 시스템이 특정 부하를 처리할 수 있나요?
- 내구성 테스트: 시스템을 장시간 실행했을 때 어떤 성능 이상이 발견될 수 있나요?
- 용량 계획 테스트: 추가 리소스를 투입했을 때 시스템이 예상대로 확장되나요?
- 성능 저하 테스트: 시스템이 부분적으로 장애가 발생했을 때 어떻게 처리되나요?

**2.1.1 지연 테스트**
- '우리 고객들이 트랜잭션이나 페이지 로드를 위해 얼마나 기다리고 있는가?'와 같은 지표
- 신중히 다뤄야할 몇가지 사항 
	- 가장 두드러지는 점은 단순한 평균값이 애플리케이션 요청에 얼마나 잘 반응하는지 측정하는데 크게 유용하지 않다는 것입니다. 

**2.1.2 처리량 테스트**
- 성능 테스트에서 두 번째로 일반적인 측정 지표일 것입니다. 
- 처리량 테스트는 지연 테스트와 어느정도 이중적인 관계가 있습니다. 
- 우리는 최대 처리량을 지연 분포가 갑자기 변화하는 순간을 관찰해서 결정합니다. 이는 사실상 시스템의 한계점(변곡점)입니다. 
- **스트레스 테스트의 목적**은 이러한 한계점과 그것이 발생하는 부하 수준을 찾는 것입니다. 
- **반면에 처리량 테스트**는 시스템이 성능 저하를 시작하기 전까지 관찰된 최대 처리량을 측정하는 것입니다. 

**2.1.3. 스트레스 테스트**
- 시스템의 여유 용량이 얼마나 있는지를 확인하기 위한 방법으로 생각할 수 있습니다. 
- 이 테스트는 시스템을 일정한 상태의 트랜잭션 상태에 두고, 동시 트랜잭션 수를 천천히 증가시켜 시스템의 성능이 저하되기 시작하는 지점을 찾는 방식으로 진행합니다.

**2.1.4 부하 테스트**
- 처리량 테스트(또는 스트레스 테스트)와는 다름 
- 보통 '시스템이 예상 부하를 처리할 수 있는가?'라는 이진적 테스트로 정의합니다

**2.1.5 내구성 테스트**
- 일부 문제들은 매우 오랜 시간 동안 또는 몇일 단위로 측정되곤 합니다. 
- 여기에는 느린 메모리 누수, 캐시 오염, 메모리 단편화 등이 포함됨
- 내구성 테스트는 실행하는데 많은 시간이 걸리고 비용이 많이 들기 때문에, 아마도 필요한 만큼 자주 수행되지 않는 경우가 많습니다. 하지만 이 과정에는 지름길은 없습니다. 
- .. 이러한 상황 떄문에 많은 팀이 결국 '프로덕션 환경에서 테스트'를 하게 됩니다. 




---
p300 
로그 이후로 ELK 스택 간단하게 설명하는게 인상 깊음


p42
JDK 미션 컨트롤(JMC) 



