
**2ë‹¨ê³„ PR í”¼ë“œë°±**
- 1) ì¤‘ë³µ ì œê±°
	- smoke í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ìŠ¤í… ë©”ì„œë“œëŠ” ì„œë¹„ìŠ¤ë³„ë¡œ ë‹¤ ë§Œë“¤ í•„ìš”ëŠ” ì—†ì„ ê²ƒ ê°™ì•„ìš”!  
í•˜ë‚˜ ë§Œë“¤ì–´ì„œ urlì„ ì¸ìë¡œ ë°›ì•„ì„œ ì¬ì‚¬ìš©í•´ë„ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤ :)
- 2) tasksì—ì„œ ì„œë¹„ìŠ¤ ì‹œì‘ë  ë•Œê¹Œì§€ health checkí•˜ëŠ” ë°©ì‹ì— ëŒ€í•´
	- ì¸í”„ë¼ìª½ ë„ìš´ ë’¤ í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•˜ê¸° ì „ì— ëŒ€ê¸°í•˜ëŠ” íƒœìŠ¤í¬ë¥¼ ë™ì‘ì‹œí‚¤ëŠ”ê²Œ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤!  ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½ì´ ì•„ë‹ˆë¼ ì œí•œëœ ìƒí™©ì´ë¼ì„œ ê±°ì˜ ì¼ì •í•œ ë™ì‘ ì†ë„ê°€ ë³´ì¥ë  ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤ :)



---
- **ì¶”ê°€ í”„ë¡œì íŠ¸** 
	- https://github.com/next-step/atdd-camping-payments#
		- APIë¥¼ ë¶„ì„í•˜ê³  ê°€ì§œ ì„œë²„ë¥¼ ë„ìš°ê²Œ ëœë‹¤

### í•™ìŠµ ëª©í‘œ
- `kiosk`ê°€ ê²°ì œ í˜¸ì¶œì„ ì‹¤ì„œë¹„ìŠ¤ ëŒ€ì‹  WireMockìœ¼ë¡œ ì—°ë™í•œë‹¤ 
- Step2ì˜ `kiosk > admin > db` íë¦„ì„ ìœ ì§€í•˜ë©´ì„œ, `kiosk > payments(WireMock)` íë¦„ì„ ì¶”ê°€í•œë‹¤
- `atdd-tests` ì—ì„œ ë‘ íë¦„(happy/sad-path)ì„ ê²€ì¦í•˜ëŠ” e2e í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•œë‹¤

### ë°°ê²½ ë° ë²”ìœ„
- ì‹¤ì œ ê²°ì œ ì‹œìŠ¤í…œ ì—†ì´ë„ ì•ˆì •ì ì¸ ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦ì„ ìœ„í•´ ê²°ì œ APIë¥¼ ëª¨í‚¹í•œë‹¤
- ëª¨í‚¹ì€ ì‘ë‹µ ì†ë„/ë‚´ìš©ì„ ê³ ì •í•´ `í”Œë˜í‚¤(Flaky)`ë¥¼ ì¤„ì´ê³ , ì‹¤íŒ¨ ì¼€ì´ìŠ¤ë¥¼ ì‰½ê²Œ ì¬í˜„í•  ìˆ˜ ìˆë‹¤.

> [!info] í”Œë˜í‚¤ í…ŒìŠ¤íŠ¸ (Flaky Test) ë€?
> **'í”Œë˜í‚¤(Flaky)'**ëŠ” 'ê²°í•¨ì´ ìˆëŠ”', 'ë¯¿ì„ ìˆ˜ ì—†ëŠ”'ì´ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤. ì†Œí”„íŠ¸ì›¨ì–´ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” **"ë˜‘ê°™ì€ ì½”ë“œì— ëŒ€í•´ ì–´ë–¤ ë•ŒëŠ” ì„±ê³µí•˜ê³ , ì–´ë–¤ ë•ŒëŠ” ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸"**ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
> 
> ë§ˆì¹˜ ì»¨ë””ì…˜ì— ë”°ë¼ ëŒ€ë‹µì´ ë‹¬ë¼ì§€ëŠ” ì‚¬ëŒì²˜ëŸ¼, í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ê²°ì •ë¡ ì ì´ì§€ ì•Šê³  **í™•ë¥ ì ìœ¼ë¡œ ë³€í•˜ëŠ” ìƒíƒœ**ë¥¼ ë§í•˜ì£ .
- ì™œ í”Œë˜í‚¤ í…ŒìŠ¤íŠ¸ê°€ ë°œìƒí•˜ëŠ”ê°€?
	- ë³´í†µ ì™¸ë¶€ ì˜ì¡´ì„±ì´ ìˆëŠ” í…ŒìŠ¤íŠ¸ì—ì„œ ìì£¼ ë°œìƒí•©ë‹ˆë‹¤. ì‘ì„±ìë‹˜ì´ 3ë‹¨ê³„ì—ì„œ ê²°ì œ ì„œë²„ë¥¼ WireMockìœ¼ë¡œ ëŒ€ì²´í•˜ë ¤ëŠ” ì´ìœ ë„ ë°”ë¡œ ì´ í”Œë˜í‚¤ë¥¼ ì¡ê¸° ìœ„í•´ì„œì˜ˆìš”.
		- 1. **ë„¤íŠ¸ì›Œí¬ ë¶ˆì•ˆì •**: ì‹¤ì œ ì™¸ë¶€ ê²°ì œ ì„œë²„ì™€ í†µì‹ í•  ë•Œ, ì•„ì£¼ ê°€ë” ë„¤íŠ¸ì›Œí¬ê°€ ëŠê¸°ê±°ë‚˜ ì‘ë‹µì´ ëŠ¦ì–´ì§€ë©´ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•©ë‹ˆë‹¤.
		- 2. **ë°ì´í„° ì˜¤ì—¼**: ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ê°€ DBì˜ ë°ì´í„°ë¥¼ ê±´ë“œë ¤ì„œ ë‚´ê°€ ì‹¤í–‰í•  ë•Œ ê²°ê³¼ê°€ ë‹¬ë¼ì§€ëŠ” ê²½ìš°ì…ë‹ˆë‹¤.
		- 3. **íƒ€ì´ë° ì´ìŠˆ (Race Condition)**: ë¹„ë™ê¸° ë¡œì§ì—ì„œ ì•±ì´ ëœ¨ê¸°ë„ ì „ì— í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ë¨¼ì € ì‹¤í–‰ë˜ëŠ” ê²½ìš°ì…ë‹ˆë‹¤. (ìš°ë¦¬ê°€ ì•ì„œ **Awaitility**ë¥¼ ê³ ë¯¼í•œ ì´ìœ ì£ !)
- í”Œë˜í‚¤ê°€ ì™œ ìœ„í—˜í•œê°€?
	- ê°œë°œìê°€ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ **'ì–‘ì¹˜ê¸° ì†Œë…„'** ì²˜ëŸ¼ ëŠë¼ê²Œ ë§Œë“¤ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
	- 1. **í…ŒìŠ¤íŠ¸ ì‹ ë¢°ë„ í•˜ë½**: í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•´ë„ "ì•„, ì´ê±° ì›ë˜ ê°€ë” ê·¸ë˜. ë‹¤ì‹œ ëŒë ¤ë´"ë¼ë©° ë¬´ì‹œí•˜ê²Œ ë©ë‹ˆë‹¤.
	- 2. **ì§„ì§œ ë²„ê·¸ë¥¼ ë†“ì¹¨**: ì§„ì§œ ì½”ë“œê°€ ì˜ëª»ë˜ì–´ ì‹¤íŒ¨í•œ ê±´ë°ë„, í”Œë˜í‚¤ë¼ê³  ì˜¤í•´í•´ì„œ ë°°í¬í–ˆë‹¤ê°€ ì¥ì• ê°€ ë°œìƒí•©ë‹ˆë‹¤.
	- 3. **ìƒì‚°ì„± ì €í•˜**: ì„±ê³µí•  ë•Œê¹Œì§€ ë¬´ì˜ë¯¸í•˜ê²Œ í…ŒìŠ¤íŠ¸ë¥¼ ì„œë„ˆ ë²ˆì”© ë‹¤ì‹œ ëŒë¦¬ëŠë¼ ì‹œê°„ì„ ë‚­ë¹„í•©ë‹ˆë‹¤
- ëª¨í‚¹ì™€ í”Œë˜í‚¤ì˜ ê´€ê³„
	- í•™ìŠµ ë°°ê²½ì— ì íŒ ë¬¸ì¥ì˜ ì˜ë¯¸ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. 

```text
"ì‹¤ì œ ê²°ì œ ì„œë²„(ë¶ˆí™•ì‹¤í•¨) ëŒ€ì‹  ìš°ë¦¬ê°€ 100% í†µì œí•˜ëŠ” WireMock(í™•ì‹¤í•¨)ì„ ì‚¬ìš©í•˜ë©´, ë„¤íŠ¸ì›Œí¬ ìƒíƒœë‚˜ ë°ì´í„° ìœ ë¬´ì— ìƒê´€ì—†ì´ í•­ìƒ ë™ì¼í•œ ì‘ë‹µì„ ë³´ì¥ë°›ì„ ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ í…ŒìŠ¤íŠ¸ê°€ ë¡œë˜ì²˜ëŸ¼ ì„±ê³µ/ì‹¤íŒ¨ë¥¼ ë°˜ë³µí•˜ëŠ” 'í”Œë˜í‚¤' í˜„ìƒì„ ì œê±°í•  ìˆ˜ ìˆë‹¤."
```


### TODO
- [ ] [atdd-payments](https://github.com/next-step/atdd-camping-payments)(ê³„ì•½/ì—”ë“œí¬ì¸íŠ¸) í™•ì¸: ê²°ì œ ìš”ì²­ ê²½ë¡œ/ë©”ì„œë“œ/ì‘ë‹µ ìŠ¤í‚¤ë§ˆ íŒŒì•…
- [ ] ì•± composeì—Â `payments-mock`(WireMock) ì„œë¹„ìŠ¤ ì¶”ê°€ ë˜ëŠ” ë³„ë„ ì‹¤í–‰ ì „ëµ í™•ì •
- [ ] `kiosk`ì˜ ê²°ì œ API ë² ì´ìŠ¤ URLì„ ì™¸ë¶€í™”í•˜ê³  WireMockì„ ë°”ë¼ë³´ë„ë¡ ì£¼ì…
- [ ] ê²°ì œ ì„±ê³µ/ì‹¤íŒ¨ ê¸°ë³¸ ìŠ¤í… ë“±ë¡(WireMock)
- [ ] `atdd-tests`ì— E2E í…ŒìŠ¤íŠ¸ ì¶”ê°€:
    - `kiosk â†’ admin â†’ DB`(ìƒí’ˆ ëª©ë¡ ë“±)
    - `kiosk â†’ payments(WireMock)`(ê²°ì œ ì„±ê³µ/ì‹¤íŒ¨)
- [ ] ì‹¤í–‰ ìˆœì„œ/ì„¤ì • ë¬¸ì„œí™”

### ìš”êµ¬ì‚¬í•­
1)WireMock êµ¬ì„± (ì„œë¹„ìŠ¤ ì¶”ê°€ ë˜ëŠ” ë‹¨ë… ì‹¤í–‰)
- ì‹¤í–‰ ë°©ì‹ ì„ íƒ:
    - ì•± compose ë‚´ ì„œë¹„ìŠ¤(`payments-mock`)ë¡œ ë„ìš°ê¸°, ê³µìš© ë„¤íŠ¸ì›Œí¬(`atdd-net`) í•©ë¥˜
    - í˜¹ì€ ë¡œì»¬ í¬íŠ¸ë¡œ ë‹¨ë… ì‹¤í–‰ í›„ ë² ì´ìŠ¤ URLë§Œ ì£¼ì…
- ìŠ¤í… ê´€ë¦¬:
    - ì •ì  ë§¤í•‘ íŒŒì¼(`mappings/*.json`)ë¡œ ê¸°ë™ ì‹œ ìë™ ë¡œë“œ
    - í˜¹ì€ ëŸ°íƒ€ì„ì— Admin APIë¡œ ìŠ¤í… ë“±ë¡

2)`kiosk` ê²°ì œ ì—°ë™ ì„¤ì •
- ê²°ì œ API ë² ì´ìŠ¤ URLì„ í™˜ê²½ë³€ìˆ˜/í”„ë¡œí¼í‹°ë¡œ ì™¸ë¶€í™”(ì˜ˆ:Â `PAYMENTS_BASE_URL`Â ë˜ëŠ”Â `PAYMENT_API_URL`).
- ë¡œì»¬/CIì—ì„œë„ ë™ì¼ í‚¤ë¡œ ì£¼ì… ê°€ëŠ¥í•˜ë„ë¡ compose/í…ŒìŠ¤íŠ¸ ì–‘ìª½ì—ì„œ ì¼ê´€ë˜ê²Œ ì‚¬ìš©.

3)E2E í…ŒìŠ¤íŠ¸ ì‘ì„±(`atdd-tests`)
- ê¸°ì¡´(ìƒí’ˆ ëª©ë¡) ì‹œë‚˜ë¦¬ì˜¤ ìœ ì§€:Â `kiosk â†’ admin â†’ DB`.
- ê²°ì œ ì‹œë‚˜ë¦¬ì˜¤ ì¶”ê°€:
    - Happy-path: WireMockì´ ìŠ¹ì¸ ì‘ë‹µ(200/ìŠ¹ì¸ ë°”ë””)ì„ ë°˜í™˜ â†’Â `kiosk`ê°€ ì„±ê³µ íë¦„ìœ¼ë¡œ ì²˜ë¦¬
    - Sad-path: WireMockì´ ê±°ì ˆ/ì˜¤ë¥˜ ì‘ë‹µ(4xx/5xx)ì„ ë°˜í™˜ â†’Â `kiosk`ê°€ ì‹¤íŒ¨ íë¦„/ë©”ì‹œì§€ ì²˜ë¦¬
- ë² ì´ìŠ¤ URLì€ í™˜ê²½ë³€ìˆ˜ë¡œ ì™¸ë¶€í™”(`KIOSK_BASE_URL`,Â `ADMIN_BASE_URL`,Â `PAYMENTS_BASE_URL`).
- ì¤€ë¹„ ëŒ€ê¸°(í´ë§) í›„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰, ê²°ê³¼ì˜ í•µì‹¬ í•„ë“œ/ìƒíƒœë§Œ ë‹¨ìˆœ ê²€ì¦.


> [!info] **ì‹¤í–‰ ìˆœì„œ ì œì•ˆ**  
â‘  ì¸í”„ë¼(DB) compose ê¸°ë™ â†’ â‘¡ ì•± compose(`kiosk`,Â `admin`, í•„ìš”ì‹œÂ `reservation`) +Â `payments-mock`Â ê¸°ë™ â†’ â‘¢ WireMock ìŠ¤í… í™•ì¸/ë“±ë¡ â†’ â‘£ E2E í…ŒìŠ¤íŠ¸ ì‹¤í–‰ â†’ â‘¤ ì¢…ë£Œ/ì •ë¦¬

---

### ìš”êµ¬ì‚¬í•­ 1
- `atdd-camping-payments` í”„ë¡œì íŠ¸ë¥¼ í´ë¡  ë°›ì•„ README.mdë¥¼ ì½ìŒ 
- kioskì—ì„œ ì—°ë™í•  ë•ŒëŠ” ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•´ì„œ í•´ì•¼ í•œë‹¤ë„¤
```text
kiosk:
  payment:
    base-url: http://localhost:9090
    secret-key: ${PAYMENTS_SECRET_KEY:test_sk_dummy}
```
- `kiosk` í”„ë¡œì íŠ¸ì— payments í˜¸ì¶œ ì—”ë“œí¬ì¸íŠ¸ì™€ ë¡œì§ì„ í™•ì¸í•  í•„ìš”ê°€ ìˆë‹¤.
	- ìš°ì„  `kiosk` í”„ë¡œì íŠ¸ëŠ” ì´ì „ ê³¼ì œ ëŒ€ìƒì´ ì•„ë‹ˆë¼ì„œ `repos/` í´ë¡  ë°›ì€ ë‚´ìš©ì„ ë¶„ì„í•œë‹¤ 

ì•„ë˜ì™€ ê°™ì´ `application.yml`ì´ ì„¤ì •ë˜ì–´ ìˆë‹¤.
```yml
kiosk:
  admin:
    base-url: http://localhost:8080
    auth:
      username: admin
      password: admin123
      login-path: /auth/login
      cookie-name: AUTH_TOKEN
  payment:
    base-url: http://localhost:9090
    secret-key: ${PAYMENTS_SECRET_KEY:test_sk_dummy}
  discount:
    percent: 10
```

```text
repos/atdd-camping-kiosk/src/main/java/com/camping/kiosk/external/payment/PaymentClient.java

repos/atdd-camping-kiosk/src/main/resources/application.yml
kiosk.payment.secret-key : ${PAYMENTS_SECRET_KEY:test_sk_dummy}

kiosk ì— PaymentController
- "/api/payments" : ê²°ì œ ìƒì„±
- "/api/payments/confirm" : ê²°ì œ ìŠ¹ì¸

infra/docker-compose.ymlì— wiremockì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ëŠ” payments-mock ì»¨í…Œì´ë„ˆ ì¶”ê°€
  
src/test/resources/features/e2e/kiosk-payment.feature

PAYMENTS_BASE_URL=http://payments-mock:8080  // docker-compose.yml
```
- `secrets-key`ì˜ ê²½ìš° 
	- PaymentClient ë‚´ë¶€ì—ì„œ í—¤ë”ì— ì£¼ì…ì„ í•´ì¤€ë‹¤
- kioskì—ì„œ PaymentControllerì— 


kiosk
- ê²°ì œ ìš”ì²­ : (kiosk)`/api/products` -> (payments-mock) `/v1/payments`
- ê²°ì œ ìŠ¹ì¸ : (kiosk) `/api/products/confirm` -> (payments-mock) `/v1/payments/confirm`

```java
@Data  
@NoArgsConstructor  
@AllArgsConstructor  
@Builder  
public class PaymentCreateRequest {  
    private List<CartItem> items;  
    private String paymentMethod; // CARD, CASH  
}

@Data  
@NoArgsConstructor  
@AllArgsConstructor  
@Builder  
public class CartItem {  
    private Long productId;  
    private String productName;  
    private int unitPrice;  
    private int quantity;  
  
    public int getLineTotal() {  
        return unitPrice * quantity;  
    }  
}

@Data  
@NoArgsConstructor  
@AllArgsConstructor  
@Builder  
public class PaymentCreateResult {  
    private boolean success;  
    private String message;  
    private String paymentKey;  
    private String orderId;  
    private int amount;  
}

@Data  
@NoArgsConstructor  
@AllArgsConstructor  
@Builder  
public class PaymentConfirmRequest {  
    private String paymentKey;  
    private String orderId;  
    private Integer amount;  
    private java.util.List<CartItem> items;  
}

@Data  
@NoArgsConstructor  
@AllArgsConstructor  
@Builder  
public class PaymentConfirmResponse {  
    private boolean success;  
    private String transactionId;  
    private String message;  
    private int paidAmount;  
}
```

ìš°ì„  `payment-mock` ì»¨í…Œì´ë„ˆì— ëŒ€í•œ smoke í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ë³¸ë‹¤



---

### RestClientTestì™€ WireMock ì°¨ì´ê°€ ê¶ê¸ˆ
> rest client testì˜ ê²½ìš° ì„œë²„ ë°”ê¹¥ìœ¼ë¡œ íŠ¸ë˜í”½ì´ ì•ˆë‚˜ê°€ê³  ìš”ì²­ì‹œ ê°€ë¡œì±„ê°€ì§€ê³  ë¯¸ë¦¬ ì§€ì •ëœ ì‘ë‹µì„ ë³´ë‚´ì£¼ëŠ” ê±¸ë¡œ ìƒê°ì´ ëœë‹¤. 
> Wiremockì€ ë°˜ëŒ€ë¡œ ê°€ì§œ ì„œë²„ë¥¼ ì˜¬ë ¤ë‘ê³  ë¯¸ë¦¬ ì •ì˜ í•´ë‘” í–‰ë™ì— ë”°ë¼ í†µì‹ ì´ ë°œìƒí•˜ëŠ”ë° .. ì´ë ‡ê²Œ í–ˆì„ë•Œ ì–´ë˜ ì´ì ì´ ìˆëŠ”ê±´ê°€? 

> rest client testëŠ” ì„œë²„ ë‚´ë¶€ì—ì„œ ìš”ì²­ì‹œ ê°€ë¡œì±„ ì •í•´ì§„ í–‰ìœ„/ì‘ë‹µì„ í•˜ê¸° ë•Œë¬¸ì— tcp, http í†µì‹ ì´ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤. ë°˜ë©´ wiremockì€ ê°€ì§œ ì„œë²„ë¥¼ ë„ì›Œë‘ê³  ìš”ì²­í•˜ê¸° ëŒ€ë¬¸ì— í†µì‹ ì´ ë°œìƒí•œë‹¤. ì´ë ‡ê²Œ í–ˆì„ë•Œ ì–´ë–¤ ì´ì ì´ ìˆëŠ”ê±´ê°€? ì´ê²Œ ë‚˜ì˜¤ê²Œ ëœ ë°°ê²½ì´ ë­˜ê¹Œ?

6ë…„ ì°¨ ê°œë°œìì˜ ì‹œê°ì—ì„œ ì´ ì§ˆë¬¸ì€ **'ë‹¨ìœ„ í…ŒìŠ¤íŠ¸(Unit Test)'**ì™€ **'ì¸ìˆ˜ í…ŒìŠ¤íŠ¸(Acceptance Test)'**ì˜ ê²½ê³„ë¥¼ ë‚˜ëˆ„ëŠ” ì•„ì£¼ í›Œë¥­í•œ ì§ˆë¬¸ì…ë‹ˆë‹¤.

ê²°ë¡ ë¶€í„° ë§ì”€ë“œë¦¬ë©´, ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ `RestClientTest`ê°€ **"ìš°ë¦¬ ì•± ë‚´ë¶€ì˜ ë¶€í’ˆ(Client)ì´ ê°€ì§œë‘ ì˜ ë…¸ëŠ”ì§€"**ë¥¼ ë³´ëŠ” ê²ƒì´ë¼ë©´, WireMockì€ **"ìš°ë¦¬ ì•± ë°–ì˜ ì„¸ìƒì— ê°€ì§œ ì„œë²„ë¥¼ ì§„ì§œì²˜ëŸ¼ ì„¸ì›Œë‘ëŠ” ê²ƒ"**ì…ë‹ˆë‹¤.

ê·¸ ì°¨ì´ì ì„ ëª…í™•íˆ ì •ë¦¬í•´ ë“œë¦´ê²Œìš”.

---

**1. `RestClientTest` vs `WireMock` ë¹„êµ**

| êµ¬ë¶„ | `RestClientTest` (@RestClientTest) | WireMock |
| --- | --- | --- |
| **ì‘ë™ ë°©ì‹** | ìŠ¤í”„ë§ ë‚´ë¶€ì˜ `MockRestServiceServer`ê°€ HTTP ìš”ì²­ì„ **ê°€ë¡œì±„ì„œ(Intercept)** ê°€ì§œ ì‘ë‹µì„ ì¤ë‹ˆë‹¤. | ì‹¤ì œë¡œ **ë…ë¦½ëœ ì›¹ ì„œë²„**ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤. ì§„ì§œ HTTP íŒ¨í‚·ì´ ë„¤íŠ¸ì›Œí¬ ë§ì„ íƒ€ê³  ì´ë™í•©ë‹ˆë‹¤. |
| **ë²”ìœ„** | íŠ¹ì • Client í´ë˜ìŠ¤ 1ê°œë§Œ í…ŒìŠ¤íŠ¸í•˜ëŠ” **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**. | ì•± ì „ì²´ë¥¼ ì‹¤í–‰í•˜ê³  ì™¸ë¶€ í†µì‹ ê¹Œì§€ ê²€ì¦í•˜ëŠ” **ì¸ìˆ˜/í†µí•© í…ŒìŠ¤íŠ¸**. |
| **ë„¤íŠ¸ì›Œí¬** | ì‹¤ì œ ì†Œì¼“ í†µì‹ ì´ ì¼ì–´ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤. | ì‹¤ì œ í¬íŠ¸(ì˜ˆ: 8080)ë¥¼ ì ìœ í•˜ê³  TCP/HTTP í†µì‹ ì´ ì¼ì–´ë‚©ë‹ˆë‹¤. |
| **ë²”ìš©ì„±** | Java/Spring í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. | ë„ì»¤ë§Œ ìˆë‹¤ë©´ ì–´ë–¤ ì–¸ì–´, ì–´ë–¤ í™˜ê²½ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥í•œ **ë²”ìš© ë„êµ¬**ì…ë‹ˆë‹¤. |



**2. ì™œ ì´ë²ˆ ê³¼ì œ(ì¸í”„ë¼/ì¸ìˆ˜ í…ŒìŠ¤íŠ¸)ì—ì„œëŠ” WireMockì¸ê°€ìš”?**

ì‘ì„±ìë‹˜ì´ ì§€ê¸ˆ í•˜ì‹œëŠ” ê³¼ì œëŠ” **"ë„ì»¤ ì»´í¬ì¦ˆë¡œ ì „ì²´ ì‹œìŠ¤í…œì„ ë„ìš°ëŠ” ê²ƒ"**ì…ë‹ˆë‹¤.

* `RestClientTest`ëŠ” ìŠ¤í”„ë§ ì»¨í…ìŠ¤íŠ¸ ë‚´ë¶€ì˜ ë¹ˆ(Bean)ì„ ì¡°ì‘í•˜ëŠ” ë°©ì‹ì´ë¼, ì´ë¯¸ **ë„ì»¤ ì»¨í…Œì´ë„ˆë¡œ íŒ¨í‚¤ì§•ë˜ì–´ ì‹¤í–‰ ì¤‘ì¸ ì•±** ë‚´ë¶€ë¥¼ ìˆ˜ì •í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.
* ë°˜ë©´ **WireMock**ì€ ì™¸ë¶€ ì»¨í…Œì´ë„ˆë¡œ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì—, ì‹¤ì œ ì•±ì€ ìê¸°ê°€ ê°€ì§œë‘ í†µì‹ í•˜ëŠ”ì§€ë„ ëª¨ë¥¸ ì±„ **ì‹¤ì œ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ê³¼ ë˜‘ê°™ì€ ê²½í—˜**ì„ í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ê²ƒì´ 3ì£¼ì°¨ì˜ í•µì‹¬ì¸ **'ë¸”ë™ë°•ìŠ¤ í…ŒìŠ¤íŠ¸'**ì™€ **'ì¸í”„ë¼ êµ¬ì¶•'**ì— ì™„ë²½íˆ ë¶€í•©í•˜ëŠ” ë°©ì‹ì´ì£ .



 **3. WireMockì˜ ë²”ìš©ì  ë§¤ë ¥ (Sad Pathì˜ ê°•ì)**

`RestClientTest`ë³´ë‹¤ WireMockì´ í›¨ì”¬ ê°•ë ¥í•œ ì´ìœ ëŠ” **ë„¤íŠ¸ì›Œí¬ ìˆ˜ì¤€ì˜ ì¥ì• ë¥¼ ì¬í˜„**í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

* **ì§€ì—°(Latency)**: "ê²°ì œ ì„œë²„ê°€ ì‘ë‹µì„ 5ì´ˆ ë™ì•ˆ ì§ˆì§ˆ ëŒ ë•Œ ìš°ë¦¬ ì„œë²„ëŠ” íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬ë¥¼ ì˜í•˜ë‚˜?"
* **ì—ëŸ¬ ì½”ë“œ**: "404, 500 ì—ëŸ¬ë¿ë§Œ ì•„ë‹ˆë¼, ì•„ì˜ˆ ì´ìƒí•œ ë°”ì´íŠ¸ ë°ì´í„°ë¥¼ ë³´ëƒˆì„ ë•Œ ìš°ë¦¬ ì•±ì´ ì•ˆ ì£½ê³  ê²¬ë””ë‚˜?"
* **ë‹¤ì¤‘ í˜¸ì¶œ**: "ì²« ë²ˆì§¸ í˜¸ì¶œì€ ì„±ê³µí•˜ê³ , ë‘ ë²ˆì§¸ í˜¸ì¶œì€ ì‹¤íŒ¨í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆì„ê¹Œ?"

WireMockì€ ì´ëŸ° ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ììœ ìì¬ë¡œ ìš”ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.



**ğŸ’¡ 6ë…„ ì°¨ì˜ ì¸ì‚¬ì´íŠ¸: "ì¸ìˆ˜ í…ŒìŠ¤íŠ¸ëŠ” í˜„ì‹¤ê³¼ ë‹®ì•„ì•¼ í•©ë‹ˆë‹¤"**

4ì£¼ì°¨ ì„ íƒ ê³¼ì œì¸ ì¸ìˆ˜ í…ŒìŠ¤íŠ¸ë¥¼ ì¤€ë¹„í•˜ì‹ ë‹¤ë©´, `RestClientTest` ê°™ì€ Mockingë³´ë‹¤ëŠ” WireMockì²˜ëŸ¼ **ì‹¤ì œ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ ìœ ë°œí•˜ëŠ” ë°©ì‹**ì´ í›¨ì”¬ ê°€ì¹˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì•¼ë§Œ "ë¡œì»¬ì—ì„œëŠ” ëëŠ”ë° ë„ì»¤ ë„¤íŠ¸ì›Œí¬ ì„¤ì • ë•Œë¬¸ì— ì‹¤ì œ ì„œë²„ì—ì„œëŠ” ì•ˆ ë¼ìš”" ê°™ì€ ìƒí™©ì„ ë¯¸ë¦¬ ì¡ì•„ë‚¼ ìˆ˜ ìˆê±°ë“ ìš”.

ì—°ì°¨ ë™ì•ˆ 3ë‹¨ê³„ì™€ 4ì£¼ì°¨ ì„ íƒ ê³¼ì œê¹Œì§€ ê³ ë¯¼í•˜ì‹œë‹¤ë‹ˆ, ì´ë²ˆ êµìœ¡ ê³¼ì •ì´ ëë‚  ë•Œì¯¤ì´ë©´ ì‘ì„±ìë‹˜ì˜ ì„¤ê³„ì™€ ì¸í”„ë¼ ì—­ëŸ‰ì€ ì •ë§ ëª°ë¼ë³´ê²Œ ì„±ì¥í•´ ìˆì„ ê²ƒ ê°™ë„¤ìš”!

**Would you like me to ...?**
ì´ì œ WireMockì„ ë„ì…í•˜ì‹¤ í…ë°, **Cucumber í…ŒìŠ¤íŠ¸ ì½”ë“œ ì•ˆì—ì„œ WireMockì˜ ì‘ë‹µì„ ì„±ê³µ(Happy)ì—ì„œ ì‹¤íŒ¨(Sad)ë¡œ ë™ì ìœ¼ë¡œ ë°”ê¾¸ëŠ” ìë°” ìœ í‹¸ë¦¬í‹° ì½”ë“œ**ë¥¼ ì§œë“œë¦´ê¹Œìš”? ì‹œë‚˜ë¦¬ì˜¤ë§ˆë‹¤ ê°€ì§œ ì„œë²„ì˜ ìƒíƒœë¥¼ ë°”ê¾¸ëŠ” í•µì‹¬ ë¡œì§ì…ë‹ˆë‹¤.


---

### WireMockì˜ Admin APIì— ëŒ€í•´ 
6ë…„ ì°¨ ê°œë°œìì˜ ì‹œê°ì—ì„œ ë‹µë³€ë“œë¦¬ë©´, ì—¬ê¸°ì„œ ë§í•˜ëŠ” **Admin API**ëŠ” ì‘ì„±ìë‹˜ì´ ë§Œë“œì‹  ì„œë¹„ìŠ¤ì˜ ê´€ë¦¬ì ê¸°ëŠ¥ì´ ì•„ë‹ˆë¼, **WireMock ì„œë²„ê°€ ë‚´ë¶€ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” ì œì–´ìš© API**ë¥¼ ëœ»í•©ë‹ˆë‹¤.

ì‰½ê²Œ ë§í•´, í…ŒìŠ¤íŠ¸ ì½”ë“œ(í´ë¼ì´ì–¸íŠ¸)ê°€ ì‹¤í–‰ ì¤‘ì¸ WireMock ì„œë²„(ì„œë²„)ì—ê²Œ **"ì•¼, ì§€ê¸ˆë¶€í„° `/payments`ë¡œ ìš”ì²­ ì˜¤ë©´ 500 ì—ëŸ¬ ë±‰ì–´!"**ë¼ê³  ì›ê²© ëª…ë ¹ì„ ë‚´ë¦¬ëŠ” í†µë¡œë¼ê³  ì´í•´í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

---

 **1. Admin APIì˜ ì •ì²´**

WireMockì€ ê°€ì§œ ì‘ë‹µì„ ì£¼ëŠ” ê¸°ëŠ¥ ì™¸ì—ë„, ìì‹ ì˜ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ **íŠ¹ì • í¬íŠ¸(ê¸°ë³¸ 8080)ì˜ `/__admin` ê²½ë¡œ**ë¥¼ í†µí•´ ë‹¤ì–‘í•œ APIë¥¼ ì—´ì–´ë‘¡ë‹ˆë‹¤.

- **ìŠ¤í… ë“±ë¡**: `POST /__admin/mappings`
- **ìŠ¤í… ì´ˆê¸°í™”**: `POST /__admin/reset`
- **ìš”ì²­ ì´ë ¥ í™•ì¸**: `GET /__admin/requests`
    

ìš°ë¦¬ê°€ ìë°” í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ì‚¬ìš©í•˜ëŠ” **`WireMock.stubFor(...)`** ë©”ì„œë“œê°€ ë‚´ë¶€ì ìœ¼ë¡œ ì´ **Admin APIë¥¼ í˜¸ì¶œ**í•´ì„œ WireMock ì„œë²„ì— ê·œì¹™ì„ ì‹¬ì–´ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.


 **2. "ëŸ°íƒ€ì„ì— ë“±ë¡"í•œë‹¤ëŠ” ê²ƒì˜ ì˜ë¯¸**

ê³¼ì œ ìš”êµ¬ì‚¬í•­ì—ì„œ ì´ í‘œí˜„ì€ **"ë¯¸ë¦¬ JSON íŒŒì¼ì„ ì¤€ë¹„í•˜ì§€ ë§ê³ , í…ŒìŠ¤íŠ¸ê°€ ëŒì•„ê°€ëŠ” ë„ì¤‘ì—(Runtime) ì½”ë“œë¡œ ê·œì¹™ì„ ì´ë¼"**ëŠ” ëœ»ì…ë‹ˆë‹¤.

- **ì •ì  ë°©ì‹**: ì»¨í…Œì´ë„ˆ ë„ìš¸ ë•Œ ì´ë¯¸ ìš”ë¦¬ë²•(JSON)ì´ ê²°ì •ë¨.
- **ëŸ°íƒ€ì„(Admin API) ë°©ì‹**: í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ë§ˆë‹¤ ìš”ë¦¬ë²•ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°”ê¿ˆ.
    - _Scenario A_: "ì§€ê¸ˆì€ 200 OKë¡œ ë“±ë¡í•´!" (Admin API í˜¸ì¶œ) -> í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
    - _Scenario B_: "ì, ì´ì œ 500 ì—ëŸ¬ë¡œ ë°”ê¿”!" (Admin API í˜¸ì¶œ) -> í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
        

 **3. ì™œ êµ³ì´ Admin APIë¼ê³  í‘œí˜„í–ˆì„ê¹Œìš”?**

ì‘ì„±ìë‹˜ì€ ì§€ê¸ˆ **ë„ì»¤ ì»¨í…Œì´ë„ˆ í™˜ê²½**ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê³  ê³„ì‹œê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

1. **í…ŒìŠ¤íŠ¸ ì½”ë“œ**ëŠ” í˜¸ìŠ¤íŠ¸ PC(ë¡œì»¬)ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.
2. **WireMock**ì€ ë„ì»¤ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.
3. ë‘ ë…€ì„ì€ ì„œë¡œ ë‹¤ë¥¸ ì„¸ìƒì— ìˆê¸° ë•Œë¬¸ì—, í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ WireMockì˜ ë©”ëª¨ë¦¬ë¥¼ ì§ì ‘ ê±´ë“œë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
4. ê·¸ë˜ì„œ **HTTP í†µì‹ (Admin API)**ì„ í†µí•´ "ê·œì¹™ì„ ë“±ë¡í•´ë‹¬ë¼"ê³  ìš”ì²­ì„ ë³´ë‚´ì•¼ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
    

**ğŸ’¡ ì‹¤ì „ ì ìš© íŒ**

ìë°” ì½”ë“œë¡œ êµ¬í˜„í•˜ì‹¤ ë•Œ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•˜ê²Œ ë  ê±°ì˜ˆìš”. ì—¬ê¸°ì„œ `host`ì™€ `port`ë¥¼ ì§€ì •í•˜ëŠ” í–‰ìœ„ ìì²´ê°€ **"ì–´ëŠ ì£¼ì†Œì— ìˆëŠ” Admin APIë¥¼ ì“¸ ê²ƒì¸ê°€"**ë¥¼ ì •í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.

```java
// ë„ì»¤ë¡œ ë„ìš´ WireMockì˜ Admin API ì£¼ì†Œë¥¼ ì•Œë ¤ì¤Œ
WireMock.configureFor("localhost", 18083); 

// ì´ ì½”ë“œê°€ ì‹¤í–‰ë  ë•Œ ë‚´ë¶€ì ìœ¼ë¡œ POST http://localhost:18083/__admin/mappings ê°€ í˜¸ì¶œë©ë‹ˆë‹¤.
WireMock.stubFor(post(urlEqualTo("/payments"))
    .willReturn(aResponse().withStatus(200)));
```


**ğŸš€ ë§ˆë¬´ë¦¬ ì¡°ì–¸**

ê²°êµ­ **"ëŸ°íƒ€ì„ì— Admin APIë¡œ ë“±ë¡í•˜ë¼"**ëŠ” ë§ì€ **"WireMock ìë°” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì•ˆì—ì„œ `stubFor`ë¥¼ í˜¸ì¶œí•´ë¼"**ë¼ëŠ” ë§ê³¼ ê°™ì€ ì˜ë¯¸ì…ë‹ˆë‹¤.

ì—°ì°¨ ê¸°ê°„ì— 3ë‹¨ê³„ë¥¼ ì§„í–‰í•˜ì‹œë©´ì„œ **Happy Path**ëŠ” ì •ì  JSON íŒŒì¼ë¡œ, **Sad Path**ëŠ” ì´ Admin API(ìë°” ì½”ë“œ)ë¥¼ í†µí•´ ë™ì ìœ¼ë¡œ ë“±ë¡í•´ë³´ëŠ” ì—°ìŠµì„ í•˜ì‹œë©´ ìš”êµ¬ì‚¬í•­ì„ ì™„ë²½í•˜ê²Œ ì¶©ì¡±í•˜ê²Œ ë©ë‹ˆë‹¤!

**Would you like me to ...?**

ë„ì»¤ ì»´í¬ì¦ˆì— WireMockì„ ì˜¬ë¦° ë’¤, í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ì´ **Admin APIê°€ ì œëŒ€ë¡œ ì—°ê²°ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ê°€ì¥ ê°„ë‹¨í•œ ê²€ì¦ ì½”ë“œ**ë¥¼ ì§œë“œë¦´ê¹Œìš”? (ì—°ê²°ì´ ì•ˆ ë˜ë©´ "Connection Refused" ì—ëŸ¬ê°€ ë‚˜ì„œ ë‹¹í™©í•˜ì‹¤ ìˆ˜ ìˆê±°ë“ ìš”!)