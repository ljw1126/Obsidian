
> 1. atdd-camping-tests í”„ë¡œì íŠ¸ë¥¼ ë‚´ë ¤ ë°›ëŠ”ë‹¤. 
> 2. í•˜ìœ„ì— atdd-camping-kioskë¥¼ í´ë¡ í•œë‹¤ 
> 3. kiosk í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œ, ì‹¤í–‰í•˜ëŠ” Dockerfileì„ ì‘ì„±í•œë‹¤ 
> 4. í•´ë‹¹ Dockerfileì„ ì‚¬ìš©í•˜ëŠ” docker-composeë¥¼ ì‘ì„±í•œë‹¤
> 5. build.gradle.ktsì— tasksë¥¼ ì •ì˜í•œë‹¤ (ì»¨í…Œì´ë„ˆ ì—…/ë‹¤ìš´, ìƒíƒœ í™•ì¸ ë“±)
> 6. ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•œë‹¤
> 	1. ì»¨í…Œì´ë„ˆ ì‹¤í–‰ í›„ í—¬ìŠ¤ ì²´í¬í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤í•œë‹¤

### í•™ìŠµ ëª©í‘œ
- `kiosk`Â ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì»¨í…Œì´ë„ˆë¡œ ê¸°ë™í•œë‹¤.
- `atdd-tests`ì—ì„œÂ `kiosk`Â ëŒ€ìƒ 200 ì‘ë‹µ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” smoke í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•œë‹¤.
- ë³µì¡í•œ ì˜ì¡´ ê´€ê³„(admin ë“±)ëŠ” ê±´ë„ˆë›°ê³ , â€œì•±ì´ ë– ì„œ 200ì„ ëŒë ¤ì¤€ë‹¤â€ì—ë§Œ ì§‘ì¤‘í•œë‹¤.


### TODO
- [ ] kiosk`Â ì„œë¹„ìŠ¤ ì†ŒìŠ¤ ìµœì‹ í™”(í´ë¡ /ë¸Œëœì¹˜ ë™ê¸°í™”)
- [ ] `kiosk`ìš© Dockerfile ì‘ì„±(`atdd-tests/infra/dockerfiles/Dockerfile-kiosk`)
- [ ] ë‹¨ì¼ ì„œë¹„ìŠ¤ìš© Docker Compose ì‘ì„±(`atdd-tests/infra/docker-compose.yml`)
- [ ] `atdd-tests`ì—Â `kiosk`Â 200 ì‘ë‹µ smoke í…ŒìŠ¤íŠ¸ ì„±ê³µ
- [ ] ì „ì²´ ê³¼ì •(í´ë¡ , ì‹¤í–‰ ë“±)ì„ Gradle Taskë¡œ ìë™í™”


### ìš”êµ¬ì‚¬í•­ 
#### 1) ì„œë¹„ìŠ¤ ì½”ë“œ ì¤€ë¹„ 
- `atdd-tests(=atdd-camping-tests)` ë£¨íŠ¸ì— ğŸ“ `repos` í´ë”ë¥¼ ë§Œë“ ë‹¤
- ğŸ“ `repos` í´ë” í•˜ìœ„ì— `atdd-camping-kiosk`ë¥¼ clone í•œë‹¤
	- `https://github.com/next-step/atdd-camping-kiosk`
	- `main` ë¸Œëœì¹˜ë¥¼ ê¸°ë³¸ ì‚¬ìš© 
- `.gitignore`ì— `repo/` ë””ë ‰í„°ë¦¬ëŠ” ë¬´ì‹œí•˜ë„ë¡ ì„¤ì • ì¶”ê°€ 



---

Dockerfileì„ ì‹¤í–‰í•˜ëŠ” ì „ëµì´ ë‘ ê°€ì§€ë¡œ ë‚˜ëˆ ì§„ë‹¤ 
1) ë¡œì»¬ì—ì„œ ì§ì ‘ ë¹Œë“œ > ë¹Œë“œ ê²°ê³¼ íŒŒì¼ì„ ì»¨í…Œì´ë„ˆ ë³µì‚¬í•´ì„œ ì‹¤í–‰
2) ì»¨í…Œì´ë„ˆì—ì„œ ë¹Œë“œ í›„ ì‹¤í–‰í•˜ëŠ” ë°©ì‹ 

dockerfile
```text
# Build Jar
FROM eclipse-temurin:17-jdk AS builder
WORKDIR /workspace
COPY . .
RUN chmod +x ./gradlew && ./gradlew --no-daemon clean bootJar -x test

# Run Jar
FROM eclipse-temurin:17-jdk
WORKDIR /app
COPY --from=builder /workspace/build/libs/*.jar app.jar
ENV JAVA_OPTS=""
ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]
```

docker-compose
```text
services:
  kiosk:
    build:
      context: ../repos/atdd-camping-kiosk
      dockerfile: ./dockerfiles/Dockerfile-kiosk
    container_name: atdd-kiosk
    ports:
      - "18081:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=local
      - SERVER_PORT=8080
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/"]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 30s
```


```shell
â¯ docker compose -f infra/docker-compose.yml up -d --build
[+] Building 0.0s (0/0)
could not find /Users/leejinwoo1126/Home/gitRepository/atdd-camping-tests/repos/atdd-camping-kiosk/dockerfiles: stat /Users/leejinwoo1126/Home/gitRepository/atdd-camping-tests/repos/atdd-camping-kiosk/dockerfiles: no such file or directory
```
- context ê¸°ì¤€ìœ¼ë¡œ dockerfile ì†ì„±ì˜ ê²½ë¡œë¥¼ ì°¾ëŠ”ë‹¤

```text
    build:
      context: ../repos/atdd-camping-kiosk
      dockerfile: ../../infra/dockerfiles/Dockerfile-kiosk # âœ…
```



```shell
# ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ë™(ì´ë¯¸ì§€ ë¹Œë“œ í¬í•¨)
docker compose -f atdd-tests/infra/docker-compose.yml up -d --build

# ìƒíƒœ í™•ì¸
docker compose -f atdd-tests/infra/docker-compose.yml ps
docker logs <kiosk-container-name> --tail 100

# ì¢…ë£Œ(í•„ìš” ì‹œ)
docker compose -f atdd-tests/infra/docker-compose.yml down -v
```


```shell
docker compose -f infra/docker-compose.yml up -d --build

docker compose -f infra/docker-compose.yml ps
docker logs atdd-kiosk --tail 100
```


```
healthcheck:
  # 1. í…ŒìŠ¤íŠ¸ ëª…ë ¹: ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ curlë¡œ ìê¸° ìì‹ (localhost:8080)ì—ê²Œ ì‹ í˜¸ë¥¼ ë³´ëƒ„
  test: ["CMD", "curl", "-f", "http://localhost:8080/"]
  
  # 2. ì²´í¬ ì£¼ê¸°: 10ì´ˆë§ˆë‹¤ í•œ ë²ˆì”© ì°”ëŸ¬ë´…ë‹ˆë‹¤.
  interval: 10s
  
  # 3. íƒ€ì„ì•„ì›ƒ: ì‹ í˜¸ë¥¼ ë³´ëƒˆëŠ”ë° 5ì´ˆ ë™ì•ˆ ë‹µì´ ì—†ìœ¼ë©´ ì‹¤íŒ¨ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤.
  timeout: 5s
  
  # 4. ì¬ì‹œë„ íšŸìˆ˜: ì—°ì†ìœ¼ë¡œ 10ë²ˆ ì‹¤íŒ¨í•˜ë©´ ì´ ì»¨í…Œì´ë„ˆëŠ” 'Unhealthy'ë¡œ ë‚™ì¸ì°í™ë‹ˆë‹¤.
  retries: 10
  
  # 5. ì´ˆê¸° ëŒ€ê¸° ì‹œê°„: ì•±ì´ ëœ¨ëŠ” ì‹œê°„ì´ í•„ìš”í•˜ë‹ˆ, ì²˜ìŒ 30ì´ˆ ë™ì•ˆì€ ì‹¤íŒ¨í•´ë„ ë´ì¤ë‹ˆë‹¤.
  start_period: 30s
```
ì‘ì„±ìë‹˜ì´ ë§Œë“œì‹¤ **ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸ ì½”ë“œ**ëŠ” ì»¨í…Œì´ë„ˆ ì™¸ë¶€ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.
- ë§Œì•½ `healthcheck`ê°€ ì—†ë‹¤ë©´? í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ì»¨í…Œì´ë„ˆê°€ 'Running'ì´ ë˜ìë§ˆì ìš”ì²­ì„ ë‚ ë¦¬ì§€ë§Œ, ìŠ¤í”„ë§ì€ ì•„ì§ ëœ¨ëŠ” ì¤‘ì´ë¼ **Connection Refused** ì—ëŸ¬ê°€ ë‚˜ê³  í…ŒìŠ¤íŠ¸ëŠ” ì‹¤íŒ¨í•˜ê²Œ ë©ë‹ˆë‹¤.
- **Healthcheckê°€ ìˆë‹¤ë©´?** ë„ì»¤ ì»´í¬ì¦ˆë‚˜ í…ŒìŠ¤íŠ¸ ë„êµ¬ê°€ ì»¨í…Œì´ë„ˆì˜ ìƒíƒœê°€ **Healthy**ê°€ ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¸ë‹¤ê°€ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.


```
val awaitilityVersion = "4.2.0"

// dependencies
// Awaitility  
testImplementation("org.awaitility:awaitility:${awaitilityVersion}")
```
- ì»¨í…Œì´ë„ˆ ì‹¤í–‰ì´ ë ë•Œê¹Œì§€ ë¹„ë™ê¸° ìš”ì²­ í•˜ê¸° ìœ„í•´ ì˜ì¡´ì„± ì¶”ê°€í–ˆìœ¼ë‚˜ ê·¸ì •ë„ë¡œ í•„ìš”í•œ ë‹¨ê³„ëŠ” ì•„ë‹Œê±° ê°™ì•„ ì œê±°í•¨
