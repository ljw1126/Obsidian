`260112`
- [도서 추천 - 린 애자일 기법을 활용한 테스트 주도 개발](https://www.yes24.com/product/goods/13161818)
- [1주차 미션](https://edu.nextstep.camp/s/1t00G7bI/ls/xEwpmMaZ)
- [코드 리뷰 절차](https://github.com/next-step/nextstep-docs/tree/master/codereview)

> [!info] 테스트는 살아 있는 문서이다. 
> 테스트가 없으면 나중에 설명할 때 복각(이해)하기 위해 많은 리소스가 들어간다
> 나를 믿는 대신에 테스트를 믿어 보도록 하자. 이는 곧 자신감으로 귀결 될 수 있다.

> [!info] 시나리오를 도출할 때는 육하원칙 (5W1H)를 사용한다

> [!info] 테스트 코드를 작성시 when을 먼저 작성한다. 그리고 then , given 순으로 작성한다

> AI를 활용하는 것은 좋으나, 기계적으로 작성된 (이해하지 x) 테스트 코드는 사용안하게 될 수 있다. 
- 철학에 대해 AI한테 질문하여 코드로 만들고 이를 이해하고, 의도가 맞는지 판단하도록 하자

**오후 8시 09분** 
- `인수 테스트로 개발을 주도하는 경험` 섹션 다시보기 
- `인수 테스트와 통합 테스트 비교` 섹션 다시보기


**Q.** 인수 테스트는 REST API에만 적용가능한가요? 배치 프로젝트에도 ATDD 적용 가능할까요?
**A.** 가능은 하다. 하지만 REST API가 상대적으로 난이도가 쉽다. 배치 같은 경우 외부 인프라 의존이 어려운데, Fake/Mock, 실제 서비스를 준비해야 한다. 결국 검증해야 할 조건과 `성공/실패`만 있다면 가능은 하다

테스트를 작성하기에는 일정이 바쁘고 구축하기 어렵다. 
- 테스트 작성하면 좋다는 건 다들 한다. 
- 구축 경험을 하는건 경험상 10%도 안되는거 같다.
- 남들이 하지 않는 무언가를 해보다보면 10%의 사람이 될 수도 있다. 

Q. 수료율은 어느 정도 되는가?
A. 마지막 주차까지 다하는 사람은 20~30% 정도이다. 다 안해도 수료증은 준다.

> AI 도구에서 서브 에이전트가 코드 분석을 담당한다.

> 우선 순위를 측정한다 > 인수 조건을 도출한다 > Gherkim 시나리오를 작성한다 
- Gherkim은 Cucumber에서 나온 문법인데, 형식상으로만 우선 따라해본다 
- 1주차에는 Cucumber를 사용하지 x 

> 마크다운 문서를 작성하실때 기술적인 것도 좋지만, 샘플 테스트 코드를 작성해두는 것이 효과적이다

**PR 요청시**
- 이번에 몰랐던 부분에 학습해보니 이렇다.  
- 그럼 이에 대한 피드백을 해준다 함
	- `PR을 작성할 때는 내가 리뷰 받고 싶은게 무엇인지 고민해보기`
> 최대한 PR 댓글을 활용할 수 있도록 한다. 코드 리뷰어는 강사 한분이 모두 한다 함

**1주차 단계별**
- 1단계의 경우 프롬프트를 사용하면 하루 안에 될거라 함
- 2단계의 경우 테스트 산출물까지 만듦
	- 개인별 역량 차이에 따라 여기서 시간 오래 걸릴 수 있다함 
	- 테스트 작성 경험이 많다면 충분이 하루에 2시간씩 했을때 통과 가능하다함
- 3단계에는 Production 코드를 건든다고 함
	- 이전 단계까지는 Production 코드를 건드는 일은 없다함

---

`260113`
- 강의 사이트에서 `[미션 시작하기]` 버튼을 누르면 저장소에 아이디명으로 브랜치가 생성된다 
- fork를 받는다 
- 내 저장소에 fork된 repository를 clone한다

```shell
git clone -b ljw1126 --single-branch git@github.com:ljw1126/atdd-camping-reservation.git

gco -b step1
```
- 작업이 완료 된 후 step1을 내 저장소에 올린다. 
- 그리고 [코드리뷰 2장](https://github.com/next-step/nextstep-docs/blob/master/codereview/review-step2.md)을 참고해 코드 리뷰 신청한다 


### controller 분석

#### HomeController
- 6개인데 .. html 페이지를 찾는듯하다. 이것도 필요한가 싶네??

#### ReservationController
(1)`POST http://localhost:8080/api/reservations`
- createReservation(.. )
- ReservationRequest를 받아 예약 생성하는거 같다.

(2) `GET http://localhost:8080/api/reservations/{{id}}`
- 예약을 단건 조회한다 
	- {{id}}

(3) `GET http://localhost:8080/api/reservations`
- 예약 목록을 조회한다. 
	- 날짜 기반 
	- 고객명 기반 
	- 아닌 경우 전체 조회

(4) `DELETE http://localhost:8080/api/reservations/{{id}}`
- 예약을 취소한다

(5) `PUT http://localhost:8080/api/reservations/{{id}}`
- 예약을 수정한다

(6) `GET http://localhost:8080/api/reservations/my`
- 나의 예약을 목록 조회한다. 
- name, phone 문자열 필요

(7) `GET http://localhost:8080/api/reservations/calendar`
- 예약 캘린더 조회



#### SiteController (캠핑 사이트 관리)
(1) `GET http://localhost:8080/api/sites`
- 전체 사이트 목록을 조회한다 

(2) `GET http://localhost:8080/api/sites/{{siteId}}`
- 사이트의 상세 정보를 조회한다

(3) `GET http://localhost:8080/api/sites/{{siteNumber}}/availability`
- 사이트 이용 가능 여부를 조회한다.

(4) `GET http://localhost:8080/api/sites/available`
- 이용 가능한 사이트 목록을 조회한다

(5) `GET http://localhost:8080/api/sites/search`
- 사이트를 검색한다 
	- 시작일, 종료일, 사이즈 파라미터 필요

---
> [!note] AI를 활용해서 만들고 난 후에 읽어본다. 다른 사람이 작성한 문서도 참고해보자

---
```
todo.md의 “1. 시스템 탐헝과 분석”을 수행하고 결과를 system-analysis.md 파일의 양식에 맞춰 기록해주세요. 현재 서버는 localhost:8080으로 실행중 입니다. 
```


첫번째 요청 결과
```
# 시스템 분석 결과

## API 목록
| Endpoint | Method | 목적 | 주요 파라미터 | 비고 |
|----------|--------|------|--------------|------|
| /api/sites | GET | 전체 캠핑장 사이트 목록 조회 | 없음 | 모든 사이트의 기본 정보(번호, 설명 등) 반환 |
| /api/sites/{siteId} | GET | 특정 사이트 상세 조회 | siteId (Path) | 사이트의 상세 정보 반환 |
| /api/sites/search | GET | 예약 가능한 사이트 검색 | startDate, endDate, size | **[버그]** 시작일과 종료일만 가용성 체크, 중간 날짜 무시함 |
| /api/reservations | POST | 예약 생성 | ReservationRequest Body (이름, 날짜, 사이트번호, 폰번호) | 30일 이내, 과거 날짜 불가, 이름 2자 이상 등 검증 |
| /api/reservations/{id} | GET | 예약 단건 조회 | id (Path) | 예약 상세 정보 반환 |
| /api/reservations | GET | 예약 목록 조회 | date (Optional), customerName (Optional) | 날짜별 또는 고객명별 예약 조회. 파라미터 없으면 전체 조회 |
| /api/reservations/my | GET | 내 예약 조회 | name, phone | 이름과 전화번호로 본인의 예약 목록 조회 |
| /api/reservations/calendar | GET | 월별 예약 캘린더 조회 | year, month, siteId | 특정 사이트의 월별 예약 상태(가능/불가능) 반환 |
| /api/reservations/{id} | PUT | 예약 수정 | id (Path), confirmationCode (Query), ReservationRequest Body | 본인 확인(코드) 후 예약 정보 수정 |
| /api/reservations/{id} | DELETE | 예약 취소 | id (Path), confirmationCode (Query) | 본인 확인(코드) 후 취소. 당일 취소 시 상태 구분됨 |

## 발견한 비즈니스 규칙

### 1. 예약 제한 및 검증
- **예약 기간**: 최대 30일까지만 예약 가능.
- **예약자 정보**: 이름은 2~20자, 전화번호는 숫자만 10~11자리 필수.
- **날짜 제한**: 과거 날짜 예약 불가, 종료일이 시작일보다 앞설 수 없음.

### 2. 가격 정책 (Hidden)
- **기본 요금**:
  - A구역 (대형): 80,000원
  - B구역 (소형): 50,000원
  - 기타: 60,000원
- **할증 (Surcharges)**:
  - 주말 (토, 일): 기본 요금의 30% 할증 (1.3배)
  - 성수기 (7월, 8월): 기본 요금의 50% 할증 (1.5배)
  - **성수기 주말**: 기본 요금의 70% 할증 (1.7배)

### 3. 포인트 적립 정책 (Inconsistent)
- 기본 적립률: 결제 금액의 5%
- 주말 포함 예약: 10% 적립 (`createReservation` 로직)
- *코드 불일치*: 별도 메서드(`calculatePoints`)에서는 성수기 예약 시 3% 적립 로직 존재하나 `createReservation`에는 반영 안 됨.
- *결제 수단별 차등*: (Deprecated 메서드 기준) 카드 10%, 모바일 8%, 계좌이체 5%, 현금 3%.

### 4. 사이트 데이터 및 설비
- **전기 사용**:
  - 코드 상 로직(`SiteService`): 사이트 번호가 'A'로 시작해야만 전기 사용 가능(`hasElectricity = true`).
  - 데이터 상 설명(`data.sql`): 'B' 구역 사이트 설명에도 "전기 있음"으로 명시됨. **(데이터와 로직 불일치)**

### 5. 예약 취소 정책
- 취소 시 환불 로직은 구현되어 있지 않고 상태만 변경됨.
- 당일 취소(`CANCELLED_SAME_DAY`)와 일반 취소(`CANCELLED`)로 상태가 구분됨.

### 6. 검색 로직의 치명적 허점
- 사이트 검색(`searchAvailableSites`) 시 **시작일과 종료일의 가용성만 확인**하고, 그 사이의 날짜들이 예약되어 있는지 확인하지 않음. 이로 인해 이미 예약된 날짜를 포함한 기간으로 중복 예약 검색이 될 가능성 있음.

```


```text
아래 내용을 참고해서 system-analysis.md을 수정해주세요
- 사이트와 예약 도메인 별로 API 엔드 포인트를 구분해주세요. 
- API 엔드 포인트가 총 12개인데, 누락된 API는 따로 구분해주세요.
- 명세서에 숨겨진 비즈니스 규칙을 표나 항목을 나눠 기록해주세요
- 버그 목록 (버그, 위치)을 찾아주세요
- 코드 이슈를 찾아주세요
```


```text
✦ system-analysis.md 파일을 요청하신 대로 수정 완료했습니다.
   1. API 분리: Reservation(7개)과 Site(5개) 도메인으로 나누어 총 12개의 API를 정리했습니다.
   2. 비즈니스 규칙: 가격, 예약, 포인트 정책을 표와 항목으로 구조화했습니다.
   3. 버그: SiteService의 치명적인 기간 검색 오류와 데이터 불일치 문제를 명시했습니다.
   4. 코드 이슈: God Class 문제, 동시성 이슈, 중복 코드, 하드코딩 문제 등을 상세히 기록했습니다.
```


```
todo.md에서 “2.리스크 매트릭스 작성”을 참고해 수행한 후 risk-matrix.md에 기록해주세요. risk-matrix.md에 기재된 양식을 참고해주세요.
```


```text
✦ 리스크 매트릭스 작성을 완료했습니다.
   1. 평가 수행: 주요 기능 8개를 선정하여 비즈니스 임팩트, 변경 빈도, 버그 가능성 기준으로 점수를 매겼습니다.
   2. 결과 기록: risk-matrix.md 파일에 평가표와 Top 3 선정 근거(예약 생성, 기간별 가용 사이트 검색, 예약 취소)를 상세히 기록했습니다. 특히 '기간별 가용 사이트 검색' 기능에서 발견된
      치명적인 버그가 높은 리스크 점수에 반영되었습니다.
   3. 상태 업데이트: todo.md의 해당 항목을 완료 처리했습니다.
```


```text
todo.md에 “3. 인수 조건 도출”을 참고해 수행한 결과를 acceptance-criteria.md에 기록해주세요. 처음보는 사람도 이해하기 쉽게 기록해주세요.
```


```
todo.md에 “4. Gherkin 시나리오 작성”을 참고해 수행한 결과를 scenarios.feature에 기록해주세요.
scenarios.feature에 기재된 양식을 지켜주세요.
초보자도 알기 쉽게 구분지어서 기록해주세요.
```


```
✦ Gherkin 시나리오 작성을 완료했습니다.

   1. 시나리오 작성: scenarios.feature 파일에 리스크가 높은 3가지 기능(예약 생성, 검색, 취소)에 대한 시나리오를 작성했습니다.
   2. 구성: 각 기능(Feature)별로 정상 케이스(Scenario)와 비즈니스 규칙에 따른 예외 케이스를 포함했습니다.
       * 특히 '기간별 검색' 기능에서는 중간 날짜가 예약된 경우 검색에서 제외되는지 검증하는 시나리오를 명시했습니다.
   3. 가독성: 초보자도 이해하기 쉽도록 주석으로 기능 설명과 시나리오 의도를 덧붙였습니다.
   4. 상태 업데이트: todo.md의 마지막 항목을 완료 처리했습니다.
```


> 궁금) 시나리오를 읽을때도 When, Then, Given 순으로 읽어야 하는가


