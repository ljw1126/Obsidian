- [ì €ì¥ì†Œ](https://github.com/dream-coding-academy/typescript_motion) 
- npm ìœ¼ë¡œ tsc , live-server ì„¤ì¹˜

**14.6 DOMì„ ì˜ ëª¨ë¥´ëŠ” ..**
- HTML DOMì€ `tag`
- JavaScriptì—ì„œëŠ” `node`ë¼ê³  ë¶€ë¦„
- `Node -> EventTarget`ì„ ìƒì† ë°›ìŒ
	- Node í•˜ìœ„ì—ëŠ” Document, Element, Textê°€ ìˆê³ , ìƒì† ë°›ìŒ



```typescript 
export class ImageComponent {

	private element: HTMLElement;
	
	constructor(title: string, url: string) {
		const template = document.createElement('template');
		
		template.innerHTML = `
			<section class="image">
				<div class="image__holder">
					<img class="image__thumbnail">
				</div>
				<p class="image__title"></p>
			</section>
		`;
		
		this.element = template.content.firstElementChild! as HTMLElement;
		
		const imageElement = this.element.querySelector('.image__thumbnail')! as HTMLImageElement;
	
		imageElement.src = url;
		imageElement.alt = title;
		
		const titleElement = this.element.querySelector('.image__title')! as HTMLParagraphElement;
		
		titleElement.textContent = title;
	
	}
	
	  
	
	attachTo(parent: HTMLElement, position: InsertPosition = 'afterbegin') {
		parent.insertAdjacentElement(position, this.element);
	}

}
```
- `<template>` íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ?
- `app.ts`ì— ì¶”ê°€

```typescript 
import { PageComponent } from './components/page.js';

import { ImageComponent } from './components/page/item/image.js';

  

class App {
	private readonly page: PageComponent;
	
	constructor(appRoot: HTMLElement) {
		this.page = new PageComponent();
		this.page.attachTo(appRoot);
	
		const image = new ImageComponent('Image Title', 'https://picsum.photos/600/300');
		image.attachTo(appRoot, 'beforeend');
	}

}

new App(document.querySelector('.document')! as HTMLElement);
```

```shell
$ tsc -w 
```
- íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì„ ì»´íŒŒì¼í•´ì„œ `dist`  ë””ë ‰í„°ë¦¬ì— ìƒì„±
- `dist/*.js` íŒŒì¼ì„ index.htmlì—ì„œ í˜¸ì¶œí•˜ì—¬ ì‚¬ìš©


ì»´í¬ë„ŒíŠ¸ ë¦¬íŒ©í„°ë§ 
- imageì™€ pageì— ì¤‘ë³µë˜ëŠ” ë¡œì§ì´ ì¡´ì¬ 
```typescript 
export interface Component {
	attachTo(parent: HTMLElement, position?: InsertPosition): void;
}


class BaseComponent<T extends HTMLElement> {

	protected readonly element: T;
	
	constructor(htmlString: string) {
		const template = document.createElement('template');
		template.innerHTML = htmlString;
		this.element = template.content.firstElementChild! as T;
	}

	attachTo(parent: HTMLElement, position: InsertPosition = 'afterbegin') {
		parent.insertAdjacentElement(position, this.element);
	}

}
```
- `image.ts` , `page.ts`ë¥¼ ë¦¬íŒ©í„°ë§í•œë‹¤ 
- ì œë„¤ë¦­ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ëŠ”ë‹¤


**ëª¨ë“  ì„¹ì…˜ êµ¬í˜„í•˜ê¸°** 
- Image component
- note component
- video component
- todo component

> [!info]
> **HTMLHeadElement**: HTMLì˜ head íƒœê·¸ë¥¼ ëŒ€í‘œí•˜ëŠ” ìš”ì†Œ
> **HTMLHeadingElement**: h1ê³¼ ê°™ì€ heading íƒœê·¸ë¥¼ ëŒ€í‘œí•˜ëŠ” ìš”ì†Œ


**app.ts ìƒì„± ìˆœì„œ**

`PageComponent` ìƒì„±í•˜ê²Œ ë˜ë©´ .document í•˜ìœ„ì— ul íƒœê·¸ ì¶”ê°€ë¨
```html
<main class="document">
	<ul class="page"></ul>
</main>
```

`ImageComponent` ìƒì„±
```html
 <section class="image">
	<div class="image__holder">
		<img class="image__thumbnail">
	</div>
	<h2 class="image__title"></p>
</section>
```

PageComponentì˜ addChild(image) í˜¸ì¶œ 
```typescript
// PageComponent
addChild(section: Component) {
	const item = new PageItemComponent();
	item.addChild(section); 
	item.attachTo(this.element, 'beforeend');
	item.setOnCloseListener(() => {
		item.removeFrom(this.element);
	});
}
```

PageItemComponent ìƒì„± í›„ addChilld í˜¸ì¶œí•˜ê²Œ ë˜ë©´ .page-item__bodyì— section ì¶”ê°€ë¨
```html
<li class="page-item">
	<section class="page-item__body">
		// ì—¬ê¸° ì¶”ê°€
	</section>
	<div class="page-item__controls">
	  <button class="close">&times;</button>
	</div>
</li>
```

```html
<li class="page-item">
	<section class="page-item__body">
	    <section class="image"> // ì—¬ê¸° ì¶”ê°€
		<div class="image__holder">
		    <img class="image__thumbnail">
		</div>
		<h2 class="image__title"></p>
	    </section>
	</section>
	<div class="page-item__controls">
              <button class="close">&times;</button>
	</div>
</li>   
```

PageItemComponent ìƒì„±í•œ ê²ƒì„ PageComponentì˜ `this.element`ì— ì¶”ê°€ 
- `item.attachTo(this.element, 'beforeend');` 

âœ… ì´ë¯¸ì§€ ì»´í¬ë„ŒíŠ¸ê°€ ì¶”ê°€ëœ ê²°ê³¼
- ê²°êµ­ PageComponentì˜ this.elementê°€ ul íƒœê·¸ì´ë¯€ë¡œ ê·¸ ì•ˆì— ê³„ì† ìŒ“ì„

```html
<main class="document">
	<ul class="page"> // PageComponentì˜ this.element í•´ë‹¹
		<li class="page-item"> // ImageComponent ê²°ê³¼
			<section class="page-item__body">
			    <section class="image"> // ì—¬ê¸° ì¶”ê°€
				<div class="image__holder">
				    <img class="image__thumbnail">
				</div>
				<h2 class="image__title"></p>
			    </section>
			</section>
			<div class="page-item__controls">
			      <button class="close">&times;</button>
			</div>
		</li>
	</ul>
</main>
```


**14.20 DI ë¦¬íŒ©í† ë§**
```typescript
// PageComponent
addChild(section: Component) {  
    const item = new PageItemComponent();  
    item.addChild(section);  
    item.attachTo(this.element, 'beforeend');  
    item.setOnCloseListener(() => {  
        item.removeFrom(this.element);  
    });
}
```

ê·œê²© ì •ì˜
```typescript 
interface SectionContainer extends Component, Composable {  
    setOnCloseListener(listener: OnCloseListener): void;  
}
```


```typescript
import { BaseComponent, Component } from "./component.js";  
  
export interface Composable {  
    addChild(child: Component): void;  
}  
  
type OnCloseListener = () => void;  

// âœ¨ ì‹ ê·œ ì •ì˜
interface SectionContainer extends Component, Composable {  
    setOnCloseListener(listener: OnCloseListener): void;  
}  

// âœ¨ ì‹ ê·œ ì •ì˜
type SectionContainerConstructor = {  
    new (): SectionContainer;  
}  
  
export class PageItemComponent extends BaseComponent<HTMLElement> implements SectionContainer {  
    private closeListener?: OnCloseListener;  
  
    constructor() {  
        super(`<li class="page-item">  
            <section class="page-item__body"></section>            
            <div class="page-item__controls">              
	            <button class="close">&times;</button>            
			</div>          
			</li>`);  
  
          const closeBtn = this.element.querySelector('.close')! as HTMLButtonElement;  
          closeBtn.onclick = () => {  
            this.closeListener && this.closeListener(); // nullì´ ì•„ë‹ˆë¼ë©´ í˜¸ì¶œ  
          }  
    }  
    addChild(child: Component) {  
        const container = this.element.querySelector('.page-item__body')! as HTMLElement;  
        child.attachTo(container);  
    }  
    setOnCloseListener(listener:OnCloseListener) {  
        this.closeListener = listener;  
    }}  
  
export class PageComponent extends BaseComponent<HTMLUListElement> implements Composable {  
	// DI ì£¼ì… ë°›ìŒ
	constructor(private pageItemConstructor: SectionContainerConstructor) {  
        super('<ul class="page"></ul>');  
    }  
    
    addChild(section: Component) {  
        const item = new this.pageItemConstructor();  
        item.addChild(section);  
        item.attachTo(this.element, 'beforeend');  
        item.setOnCloseListener(() => {  
            item.removeFrom(this.element);  
        });    
	}
}
```



**ğŸ¤– Gemini**
`SectionContainerConstructor`ì˜ íƒ€ì… í‘œê¸°ë²•ì´ ì–´ìƒ‰í•˜ê²Œ ëŠê»´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” TypeScriptì—ì„œ **ìƒì„±ì í•¨ìˆ˜(Constructor Function)ì˜ íƒ€ì…**ì„ ì •ì˜í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

`new (): SectionContainer`ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì˜ë¯¸ë¥¼ ê°€ì§‘ë‹ˆë‹¤:
- **`new`**: ì´ íƒ€ì…ì´ **`new` í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ í˜¸ì¶œë  ìˆ˜ ìˆëŠ” ìƒì„±ì**ì„ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
- **`()`**: ìƒì„±ìê°€ **ì¸ì ì—†ì´ í˜¸ì¶œ**ë¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ë§Œì•½ ì¸ìê°€ ìˆë‹¤ë©´ `new (name: string): SectionContainer` ì™€ ê°™ì´ í‘œí˜„í–ˆì„ ê²ë‹ˆë‹¤.
- **`: SectionContainer`**: ì´ ìƒì„±ìê°€ **`SectionContainer` íƒ€ì…ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜**í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
    
ë”°ë¼ì„œ `SectionContainerConstructor` íƒ€ì…ì€ **`SectionContainer` ì¸í„°í˜ì´ìŠ¤ì˜ ê·œê²©ì„ ì§€í‚¤ëŠ” ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ìƒì„±ì í•¨ìˆ˜**ë¥¼ ê°€ë¦¬í‚µë‹ˆë‹¤. ì¢€ ë” í’€ì–´ì„œ ì„¤ëª…í•˜ë©´, ì´ íƒ€ì…ì€ "ì¸ì ì—†ì´ í˜¸ì¶œí•˜ë©´ `SectionContainer` íƒ€ì…ì˜ ê°ì²´ë¥¼ ë§Œë“¤ì–´ë‚´ëŠ” ìƒì„±ì"ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
```typescript
class MySectionContainer implements SectionContainer {
    setOnCloseListener(listener: OnCloseListener): void {
        // ë¦¬ìŠ¤ë„ˆ ì„¤ì • ë¡œì§
    }

    // Componenent, Composable ì¸í„°í˜ì´ìŠ¤ì˜ ë©¤ë²„ êµ¬í˜„ ê°€ì •
    // ..
}

// MySectionContainerëŠ” SectionContainerConstructor íƒ€ì…ìœ¼ë¡œ í• ë‹¹ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
const SectionContainerFactory: SectionContainerConstructor = MySectionContainer;

// ì´ì œ SectionContainerFactoryë¥¼ ì‚¬ìš©í•˜ì—¬ SectionContainer ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
const sectionInstance: SectionContainer = new SectionContainerFactory();
```


>[!info] ê¸°ì¡´ì— PageComponentëŠ” PageItemComponentì— ì»¤í”Œë§ì´ ê°•í•˜ê²Œ ë˜ì–´ ìˆì—ˆë‹¤. ê·¸ë˜ì„œ ìˆ˜ì •í•˜ê¸° ìœ„í•´ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë¥¼ ì§ì ‘ ìˆ˜ì •í•˜ê³  ì»´íŒŒì¼ì„ ë‹¤ì‹œ í•´ì•¼ í–ˆë‹¤. ìƒì„±ì ì£¼ì… ë°©ì‹ìœ¼ë¡œ ë³€ê²½í•œ ì´í›„ì—ëŠ” PageComponent ë§ˆë‹¤ ì„œë¡œ ë‹¤ë¥¸ SectionContainer êµ¬í˜„ì²´ë¥¼ ì£¼ì…í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤. (loose coupling)


---

**14.22 ë‹¤ì´ì–¼ë¡œê·¸ ë§Œë“¤ê¸°**
- Image, Video, Note, Todo ë²„íŠ¼ í´ë¦­ì‹œ ë‹¤ì´ì–¼ë¡œê·¸ ì¶”ê°€
- `BaseComponent` ì´ìš©


> onclickê³¼ addEventListener ì°¨ì´ë¥¼ ì„¤ëª…í•˜ëŠ”ë° ëª¨ë¥´ê² ìŒ (14.23)
> - addEventListenerëŠ” ì´ë²¤íŠ¸ê°€ ìŒ“ì´ëŠ”ë° 
> - onclickì€ ì—¬ëŸ¬ ì´ë²¤íŠ¸ë¥¼ í•˜ë”ë¼ë„ ë®ì–´ì”Œì›Œì ¸ ë§ˆì§€ë§‰êº¼ë§Œ ë™ì‘í•œë‹¤



```typescript 
import { Component } from './components/component.js';  
import { Composable, PageItemComponent, PageComponent } from './components/page.js';  
import { ImageComponent } from './components/page/item/image.js';  
import { NoteComponent } from './components/page/item/note.js';  
import { TodoComponent } from './components/page/item/todo.js';  
import { VideoComponent } from './components/page/item/video.js';  
import {InputDialog} from "./components/dialog/dialog.js";  
import {MediaSectionInput} from "./components/dialog/input/media-input.js";  
import {TextSectionInput} from "./components/dialog/input/text-input.js";  
  
export interface MediaData {  
    readonly title: string;  
    readonly url: string;  
}  
  
export interface TextData {  
    readonly title: string;  
    readonly body: string;  
}  
  
type InputComponentConstructor<T = (MediaData | TextData) & Component> = {  
    new () : T;  
}  
  
class App {  
    private readonly page: Component & Composable;  
    constructor(appRoot: HTMLElement, private dialogRoot: HTMLElement) {  
        this.page = new PageComponent(PageItemComponent);  
        this.page.attachTo(appRoot);  
  
        this.bindElementToDialog<MediaSectionInput>('#new-image',  
            MediaSectionInput,  
            (input: MediaSectionInput) => new ImageComponent(input.title, input.url));  
  
        this.bindElementToDialog<MediaSectionInput>('#new-video',  
            MediaSectionInput,  
            (input: MediaSectionInput) => new VideoComponent(input.title, input.url))  
  
        this.bindElementToDialog<TextSectionInput>('#new-note',  
            TextSectionInput,  
            (input: TextSectionInput) => new NoteComponent(input.title, input.body));  
  
        this.bindElementToDialog<TextSectionInput>('#new-todo',  
            TextSectionInput,  
            (input: TextSectionInput) => new TodoComponent(input.title, input.body));  
    }  
    private bindElementToDialog<T extends (MediaData | TextData) & Component>(  
        selector: string,  
        InputComponent: InputComponentConstructor<T>,  
        makeSection: (input: T) => Component  
    ) {  
        const element = document.querySelector(selector)! as HTMLButtonElement;  
        element.addEventListener('click', () => {  
            const dialog = new InputDialog();  
            const input = new InputComponent();  
            dialog.addChild(input);  
            dialog.attachTo(this.dialogRoot);  
  
            dialog.setOnCloseListener(() => {  
                dialog.removeFrom(this.dialogRoot);  
            });  
            dialog.setOnSubmitListener(() => {  
                const section = makeSection(input);  
                this.page.addChild(section);  
                dialog.removeFrom(this.dialogRoot);  
            });        
		})   
	 }
 }  
  
new App(document.querySelector('.document')! as HTMLElement, document.body);
```