

**í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì¸¡ì •** 
- `C# .NET`ì€ í”„ë¡œí˜ì…”ë„ë¶€í„° ê¸°ë³¸ì ìœ¼ë¡œ ì§€ì›ì„ í•´ì¤€ë‹¤

`coverlet-coverage`
- [coverlet-coverage/coverlet: Cross platform code coverage for .NET](https://github.com/coverlet-coverage/coverlet)
	- ğŸ“Œ[coverlet/Documentation/VSTestIntegration.md at master Â· coverlet-coverage/coverlet](https://github.com/coverlet-coverage/coverlet/blob/master/Documentation/VSTestIntegration.md)
	- exclude filter ì²˜ë¦¬ í†µí•´ dtos ì œê±°í•˜ê³  ì¸¡ì • 

### xUnit í…œí”Œë¦¿ í”„ë¡œì íŠ¸ ìƒì„± (ë””ë ‰í„°ë¦¬ êµ¬ì¡°)

ğŸ’© `ë””ë ‰í„°ë¦¬ êµ¬ì¡° ë¬¸ì œ`
- ê¸°ì¡´ì— C# .NET í”„ë¡œì íŠ¸ ì•ˆì— Tests ë§Œë“¤ì–´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ëŒë ¸ëŠ”ë° .. ì´ë ‡ê²Œ í•  ê²½ìš° coverlet-coverageê°€ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤ 
- ê¸°ë³¸ì ìœ¼ë¡œ C# .NET ì§„ì˜ì—ì„œëŠ” `ëŒ€ìƒ í”„ë¡œì íŠ¸`ì™€ ê°™ì€ ìœ„ì¹˜ì— `í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸`ë¥¼ ë”°ë¡œ ë§Œë“¤ì–´ì„œ ê´€ë¦¬
- í…ŒìŠ¤íŠ¸ ê´€ë ¨ ë‚´ìš©ì€ í…ŒìŠ¤íŠ¸ìš© í”„ë¡œì íŠ¸ë¡œ ì˜®ê²¨ë²„ë¦¬ê³  `csproj`ì— referenceë¥¼ ì¶”ê°€í•˜ì—¬ ì‹¤ì œ í”„ë¡œì íŠ¸ë¥¼ ì°¸ì¡°í•œë‹¤í•¨
- ì´ë ‡ê²Œ ë¶„ë¦¬í•¨ìœ¼ë¡œì¨ ì‹¤ì œ í”„ë¡œì íŠ¸ ë¹Œë“œì‹œ í…ŒìŠ¤íŠ¸ ê´€ë ¨ íŒ¨í‚¤ì§€ë¥¼ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤í•¨ 
	- `build.gradle`ì—ì„œ ê·¸ë£¨ë¹„ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‘ì„±ì„ í–ˆì—ˆëŠ”ë° (ì‚¬ìŠ¤ê°€ ìˆ˜ë™ ë°ìŠ¤ë„¤)


ê³¼ì œ í”„ë¡œì íŠ¸ë³´ë‹¤ í•œ ë‹¨ê³„ ìœ„ì— ë£¨íŠ¸ì—ì„œ
```shell
// 1. xUnit í…œí”Œë¦¿ í”„ë¡œì íŠ¸ ìƒì„±
dotnet new xunit -n ShipParticularsApi.Tests

// 2. ìƒˆë¡œë§Œë“  í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸ì— ê¸°ì¡´ ì•± í”„ë¡œì íŠ¸ ì°¸ì¡° ì¶”ê°€
dotnet add ShipParticularsApi.Tests reference ShipParticularsApi

// 3. ì½”ë“œ ì´ë™
// ShipParticularsì— ìˆë˜ Tests í´ë” ì½”ë“œë¥¼ ShipParticularsApi.Testsë¡œ ì´ë™
// ì´ë•Œ ë‚˜ëŠ” Tests í´ë” ìì²´ë¥¼ ì˜®ê²¼ëŠ”ë°, ê·¸ëŸ¬ë‹¤ë³´ë‹ˆ namespaceê°€ í•œ depth ë” ê¸¸ì–´ì§
```
- `.sln` íŒŒì¼ì´ ìˆëŠ” ìµœìƒìœ„ ë””ë ‰í„°ë¦¬ëŠ” í”„ë¡œì íŠ¸ êµ¬ì¡°ì˜ ê¸°ì¤€ì ì´ ë¨


<img src="./images/ì½”ë“œì»¤ë²„ë¦¬ì§€1.png">
- `CoverageReport`ëŠ”  reportgenerator ë„êµ¬ í†µí•´ ìƒì„±ëœë‹¤ 
- `TestResults`ëŠ” coverlet ë„êµ¬ í†µí•´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•˜ë©´ì„œ xml íŒŒì¼ì„ ë§Œë“ ë‹¤ 
	- ì˜µì…˜ì„ ì£¼ë©´ ì—¬ëŸ¬ í™•ì¥ìë¥¼ ë§Œë“¤ì–´ ì£¼ë‚˜ ë³´ë‹¤

```text
visual studio í™•ì¥ìë¡œ coverlet.collector ê²€ìƒ‰í•´ì„œ ì„¤ì¹˜
```

> âœ… ë””ë ‰í„°ë¦¬ë¥¼ ë³µì‚¬ ë¶™ì—¬ë„£ê¸° í•˜ë©´ namespace ë³€ê²½ê³¼ using íŒ¨í‚¤ì§€ê°€ ëˆ„ë½ë˜ëŠ” ì´ìŠˆê°€ ìˆì–´ì„œ ì§ì ‘ ë‹¤ ìˆ˜ì •í•´ì•¼ í–ˆìŒ


### CLIë¡œ ë„êµ¬ ì„¤ì¹˜

```shell
// ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ì¸¡ì •
dotnet tool install -g coverlet.console

// ë ˆí¬íŠ¸ ì œë„¤ë ˆì´í„°
dotnet tool install -g dotnet-reportgenerator-globaltool

dotnet build

coverlet --version
```


### í•„í„°ë§ 
- Dtos, Exceptionsì™€ ê°™ì€ ë¶ˆí•„ìš”í•œ ë‚´ìš©ì´ ì»¤ë²„ë¦¬ì§€ì— í¬í•¨ë˜ë©´ í¼ì„¼íŠ¸ê°€ ë‚®ì•„ì§
- ğŸ’© CLI ëª…ë ¹ì–´ì— í•„í„° ì˜µì…˜ ì¶”ê°€í•˜ë ¤ê³  í–ˆìœ¼ë‚˜ ë¬¸ë²• ì—ëŸ¬ê°€ ê³„ì† ë°œìƒí•´ ì²˜ë¦¬ ëª»í•¨ 
	- powershellì´ë‹¤ ë³´ë‹ˆ .. íŠ¹ìˆ˜ë¬¸ìë‚˜ ê·¸ëŸ° ì²˜ë¦¬ë¥¼ ì¸ì‹í•˜ì§€ ëª»í•˜ëŠ” ê²ƒìœ¼ë¡œ ìƒê°

`repo/ShipParticulars/coverlet.runsettings`
```text
<?xml version="1.0" encoding="utf-8"?>
<RunSettings>
  <DataCollectionRunSettings>
    <DataCollectors>
      <DataCollector friendlyName="XPlat Code Coverage">
        <Configuration>
          <ExcludeByFile>**/Dtos/**/*.cs,**/Exceptions/**/*.cs,**/Migrations/*.cs</ExcludeByFile>
        </Configuration>
      </DataCollector>
    </DataCollectors>
  </DataCollectionRunSettings>
</RunSettings>
```

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë° ì»¤ë²„ë¦¬ì§€ xml ìƒì„±

í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì‹œì—ëŠ” `ShipParticulars.Tests` ë“¤ì–´ê°€ì„œ ì‹¤í–‰í•´ì•¼ í•˜ë‹¤ë³´ë‹ˆ ìƒëŒ€ê²½ë¡œ ì„¤ì •íŒŒì¼ì„ í˜¸ì¶œí•˜ê²Œ ëœë‹¤
```shell
dotnet test .\ShipParticularsApi.Tests.csproj --collect:"XPlat Code Coverage" /p:CoverletOutputFormat=cobertura /p:CoverletOutput=./TestResults/coverage.cobertura.xml --settings ..\coverlet.runsettings
```

âœ… output ê²½ë¡œì™€ ëª…ì¹­ì„ ì„¤ì •í•´ë†”ì•¼ì§€ ë‚˜ì¤‘ì— sonarcloudì— ë§¥ì¼ ìˆ˜ ìˆë‹¤.(ì˜µì…˜ ì•Œì•„ë³´ê¸°)

### ë ˆí¬íŠ¸ ìƒì„±
```shell
reportgenerator -reports:"{coverlet ê²°ê³¼ë¡œ ìƒì„±ëœ xmlê²½ë¡œ}" -targetdir:"coverageresults" -reporttypes:Html
```

<img src="./images/ì½”ë“œì»¤ë²„ë¦¬ì§€ ê²°ê³¼.png">


### ê¸°íƒ€ 

ShipParticulars.Testsì—ì„œ ì•„ë˜ swagger íŒ¨í‚¤ì§€ ì‚­ì œ 
```text
<PackageReference Include="Swashbuckle.AspNetCore" Version="6.6.2" />
```

```shell
dotnet restore
```
- `dotnet test` ì‹¤í–‰ì‹œ í†µí•© í…ŒìŠ¤íŠ¸ê°€ Developmentë¡œ ì‹¤í–‰ë˜ê³  ìˆì–´ Program.csì— ë¶„ê¸°ë¬¸ì— Swagger í˜¸ì¶œí•˜ë‹¤ë³´ë‹ˆ ì»´íŒŒì¼ ì—ëŸ¬ ë°œìƒğŸ’©
- `appsettings.Test.json`ì„ ShipParticulars í”„ë¡œì íŠ¸ì— ì¶”ê°€
- `CustomWebApplicationFactory.cs` // ShipParticulars.Tests
	- `builder.UseEnvironment("Test");` // Test í™˜ê²½ë³€ìˆ˜ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •


### Reference.
[coverlet/Documentation/VSTestIntegration.md at master Â· coverlet-coverage/coverlet](https://github.com/coverlet-coverage/coverlet/blob/master/Documentation/VSTestIntegration.md)



---

**TODO**
- í”„ë¡œì íŠ¸ì— íŒ¨í‚¤ì§€ ì •ë¦¬ (ok)
	- `ShipParticulars` 
	- `ShipParticulars.Tests`
- README.md ì‘ì„±
- remote ì €ì¥ì†Œ ë°˜ì˜ 
	- ê°œì¸êº¼ë§Œ ìš°ì„  ë°˜ì˜..



