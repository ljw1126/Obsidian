

- blob에 있는 파일은 UTC 기준으로 저장된다.


한국 표준시(KST)는 **UTC(협정 세계시)보다 9시간 빠릅니다.** (KST = UTC + 9)

| **기준**    | **UTC (Universal Time)** | **KST (Korean Time)**    |
| --------- | ------------------------ | ------------------------ |
| **자정**    | 2025-11-19T00:00:00Z     | 2025-11-19 09:00:00      |
| **한국 오전** | 2025-11-19T03:00:00Z     | 2025-11-19 12:00:00 (정오) |
| **한국 오후** | 2025-11-19T09:10:00Z     | 2025-11-19 18:10:00 (저녁) |
| **날짜 변경** | 2025-11-19T15:00:00Z     | 2025-11-20 00:00:00      |

> 🔑 **핵심:** 파일명이나 DB에 `Z`가 붙어있거나 (`2025-11-19T09:10:00Z`), 코드에서 `UtcNow`를 사용했다면, 이는 **UTC 기준 시간**입니다.

> 한국 표준시 (KST) = UTC + 9시간
> UTC 시간을 구하려면 KST에서 9시간을 **빼야** 합니다


|**포맷**|**결과 예시**|**해석**|
|---|---|---|
|**제시 포맷 (정보 없음)**|`2025-11-19T09:10:00.000`|이 시간이 UTC 9시인지, KST 9시인지 **알 수 없습니다.**|
|**UTC 포맷 (Z)**|`2025-11-19T09:10:00Z`|**명확히 UTC 9시**입니다.|
|**KST 오프셋**|`2025-11-19T18:10:00+09:00`|**명확히 KST 18시 10분**입니다.|

### C# 메서드 

`ToString("yyyy-MM-ddTHH:mm:ss.000f")`
- 시간을 문자열로 포맷팅하며, 시간대 정보(Z)를 출력하지 않습니다. 
- **`f`의 의미:** 소수점 이하의 남는 0을 제거하는 포맷 지정자입니다. (밀리초 포맷을 지정하는 데는 `fff` 가 더 명확합니다.)


`DateTime.UtcNow.ToString("yyyy-MM-ddTHH:mm:ssZ")`
- 이 구문은 **현재 UTC 시간을 표준 ISO 8601 형식으로 출력**하는 가장 안전한 방법 중 하나입니다
- **`DateTime.UtcNow`:** 현재 시간을 **`DateTimeKind.Utc`** 객체로 생성합니다.
	- 9시간 전
- **`...Z` 포맷:** 문자열 끝에 `Z`를 명시적으로 붙여서 이 시간이 **UTC 기준**임을 외부 시스템에 알려줍니다. (Cosmos DB에 저장 시 권장되는 형식입니다.)


`ToString("yyyy-MM-ddTHH:mm:ss.fffZ")`
- **밀리초(`fff`)를 명확하게 포함**하도록 지정
- **동작:** `fff`를 통해 밀리초 세 자리까지 출력하고, `Z`를 붙여서 UTC 시간임을 명시합니다
- **출력 예:** `2025-11-19T08:37:06.123Z`
- **용도:** 데이터 정밀도를 높여야 하거나, Cosmos DB 같은 시스템이 밀리초까지 요구할 때 C 구문 대신 이 구문을 사용합니다.

---

> 운영에 하나씩 존재하고, 갱신되는 형태인 듯 하다

`3E3863_controlLog10Min`
```json
{
    "sk": "3E3863",
    "id": "3E3863_controlLog10Min",
    "lastDateTimeFirstInsert10Min": "2025-11-19T09:00:00Z", // 로컬이 KST라서 잘못 기록됨
    "lastDateTimeSecondInsert10Min": "2016-01-01T12:00:00.000Z",
    "firstDataDateTime10Min": "2025-11-18T00:10:00Z",
    "_rid": "Gt8yAKlp+fLGAAAAAAAAAA==",
    "_self": "dbs/Gt8yAA==/colls/Gt8yAKlp+fI=/docs/Gt8yAKlp+fLGAAAAAAAAAA==/",
    "_etag": "\"00000000-0000-0000-592c-f2e7e80501dc\"",
    "_attachments": "attachments/",
    "_ts": 1763540250
}

// 윈도우 설정에서 UTC 시간으로 바꾸니 의도대로 동작
{
    "sk": "3E3863",
    "id": "3E3863_controlLog10Min",
    "lastDateTimeFirstInsert10Min": "2025-11-19T00:00:00Z", // 다음 시작 시간
    "lastDateTimeSecondInsert10Min": "2016-01-01T12:00:00.000Z",
    "firstDataDateTime10Min": "2025-11-18T00:10:00Z", // 처음실행한 시간
    "_rid": "Gt8yAKlp+fJYAwAAAAAAAA==",
    "_self": "dbs/Gt8yAA==/colls/Gt8yAKlp+fI=/docs/Gt8yAKlp+fJYAwAAAAAAAA==/",
    "_etag": "\"00000000-0000-0000-59c5-1640380501dc\"",
    "_attachments": "attachments/",
    "_ts": 1763605593
}
```

윈도우 설정으로 UTC 바꾸고 실행시 정상적으로 날짜가 출력된다 
- 11/18일 00시 10분 ~ 23시 50분까지
```text
[2025-11-20T02:26:03.629Z] Insert10MinDatatoDocumentDbAsync ========
[2025-11-20T02:26:03.634Z] lastDate : 2025-11-18 오전 12:10:00, lastDateConverted : 2025-11-18T00:10:00Z
[2025-11-20T02:26:03.636Z] firstDate : 2025-11-18 오전 12:10:00, firstDateConverted : 2025-11-18T00:10:00Z
[2025-11-20T02:26:03.727Z] 10Min : 2025-11-18 오전 12:10:00 / POS QINGDAO
..

[2025-11-20T02:26:32.816Z] lastDate : 2025-11-18 오후 11:50:00, lastDateConverted : 2025-11-18T23:50:00Z
[2025-11-20T02:26:32.818Z] firstDate : 2025-11-18 오후 11:50:00, firstDateConverted : 2025-11-18T23:50:00Z
[2025-11-20T02:26:32.923Z] 10Min : 2025-11-18 오후 11:50:00 / POS QINGDAO
[2025-11-20T02:26:32.925Z] LastPositionClient.SetLastPositionControllerAsync : System.Dynamic.ExpandoObject
[2025-11-20T02:26:33.013Z] Insert10MinDatatoDocumentDbAsync ========
[2025-11-20T02:26:33.015Z] lastDate : 2025-11-19 오전 12:00:00, lastDateConverted : 2025-11-19T00:00:00Z
[2025-11-20T02:26:33.018Z] firstDate : 2025-11-19 오전 12:00:00, firstDateConverted : 2025-11-19T00:00:00Z
[2025-11-20T02:26:33.120Z] 10Min : 2025-11-19 오전 12:00:00 / POS QINGDAO
[2025-11-20T02:26:33.123Z] LastPositionClient.SetLastPositionControllerAsync : System.Dynamic.ExpandoObject
[2025-11-20T02:26:33.531Z] Executed 'Functions.LoggerDataInsert10Min' (Succeeded, Id=9bd6cd4d-b498-4859-9497-c344af96750a, Duration=35409ms)
```



`3E3863_controlLog1Hour`
```json
// 로컬 KST
{
    "sk": "3E3863",
    "id": "3E3863_controlLog1Hour",
    "lastDateTimeFirstInsert1Hour": "2025-11-19T19:00:00Z",
    "lastDateTimeSecondInsert1Hour": "2025-11-18T09:10:00.0000",
    "firstDataDateTime1Hour": "2025-11-19T04:00:00Z",
    "_rid": "Gt8yAKlp+fJoAQAAAAAAAA==",
    "_self": "dbs/Gt8yAA==/colls/Gt8yAKlp+fI=/docs/Gt8yAKlp+fJoAQAAAAAAAA==/",
    "_etag": "\"00000000-0000-0000-592d-2b46740501dc\"",
    "_attachments": "attachments/",
    "_ts": 1763540344
}


// 로컬 UTC 변경 후
{
    "sk": "3E3863",
    "id": "3E3863_controlLog1Hour",
    "lastDateTimeFirstInsert1Hour": "2025-11-19T00:00:00Z",
    "lastDateTimeSecondInsert1Hour": "2025-11-18T00:10:00.0000",
    "firstDataDateTime1Hour": "2025-11-18T01:00:00Z",
    "_rid": "Gt8yAKlp+fLuAwAAAAAAAA==",
    "_self": "dbs/Gt8yAA==/colls/Gt8yAKlp+fI=/docs/Gt8yAKlp+fLuAwAAAAAAAA==/",
    "_etag": "\"00000000-0000-0000-59d0-267fa40501dc\"",
    "_attachments": "attachments/",
    "_ts": 1763610344
}
```

> 나는 11/18 밤 1시에 날짜 정보가 필요한데, KST로 이상하게 바뀌면서 아침 10시 데이터를 가져와 연산하니 1시간 그룹이 안 맞은 거였다

```text

[1시간 시작] // UTC로 돌리니 정상적으로 그룹핑 해서 결과가 나오는 듯 하다
[2025-11-20T03:44:15.508Z] 1Hour Start : 2025-11-18 오전 12:10:00 / POS QINGDAO
[2025-11-20T03:45:32.342Z] Query10MinDataAsync startTime : 2025-11-18T00:10:00.000Z , endTime = 2025-11-19T00:00:00.000Z
[2025-11-20T03:45:38.995Z] shipDatas Count : 148
[2025-11-20T03:45:46.957Z] 1Hour : 2025-11-19 오전 12:00:00 / POS QINGDAO
```
