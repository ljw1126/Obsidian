- wsl2 docker ì„¤ì¹˜ 
	- docker settings - general - wsl2 ì˜µì…˜ í™œì„±í™”


```shell
dotnet add package Testcontainers.Xunit
```
- í˜„ì¬ xUnit v2ë¥¼ ì‚¬ìš© ì¤‘ì´ë¼ì„œ

```shell
dotnet add package Testcontainers.MsSql
```


### Container-per-test Strategy 
ìš°ì„ ì€ ì¶œë ¥ë§Œ í™•ì¸í•´ë³¸ë‹¤..

```cs
using Testcontainers.MsSql;
using Xunit.Abstractions;

namespace ShipParticularsApi.Tests.Tests.Testcontainers
{
    public class DatabaseContainerPerTestcs(ITestOutputHelper output)
        : IAsyncLifetime
    {
        private readonly MsSqlContainer _dbContainer = new MsSqlBuilder()
            .WithImage("mcr.microsoft.com/mssql/server:2022-latest")
            .WithPassword("qwer1234!@#$")
            .WithCleanUp(true)
            .Build();

        private string connectionString = string.Empty;

        [Fact]
        public void Test()
        {
            output.WriteLine($"Connection String: {connectionString}");
        }

        public Task DisposeAsync()
        {
            return _dbContainer.StopAsync();
        }

        public async Task InitializeAsync()
        {
            await _dbContainer.StartAsync();

            connectionString = _dbContainer.GetConnectionString();
            output.WriteLine("InitializeAsync í˜¸ì¶œ");
        }
    }
}

```

`ì‹¤í–‰ ê²°ê³¼`
```text
  í‘œì¤€ ì¶œë ¥:â€‰
InitializeAsync í˜¸ì¶œ
Connection String: Server=127.0.0.1,60764;Database=master;User Id=sa;Password=qwer1234!@#$;TrustServerCertificate=True
```


ğŸ’©`Fluent Assertions ë¼ì´ì„¼ìŠ¤ ì´ìŠˆ`
```text
 Warning:
 The component "Fluent Assertions" is governed by the rules defined in the Xceed License Agreement and
 the Xceed Fluent Assertions Community License. You may use Fluent Assertions free of charge for
 non-commercial use only. An active subscription is required to use Fluent Assertions for commercial use.
 Please contact Xceed Sales mailto:sales@xceed.com to acquire a subscription at a very low cost.
 A paid commercial license supports the development and continued increasing support of
 Fluent Assertions users under both commercial and community licenses. Help us
 keep Fluent Assertions at the forefront of unit testing.
 For more information, visit https://xceed.com/products/unit-testing/fluent-assertions/
```
- ìƒì—…ìš© ì‚¬ìš©ì‹œ ë²•ì  ë¶„ìŸ ë°œìƒ ê°€ëŠ¥ 
	- `Shouldy` íŒ¨í‚¤ì§€ ì‚¬ìš© ê¶Œì¥âœ… (`gemini`)
	- [shouldly/LICENSE.txt at master Â· shouldly/shouldly](https://github.com/shouldly/shouldly/blob/master/LICENSE.txt)

### DatabaseContainerPerTest


startì™€ stopì´ 4ê°œ í™•ì¸ëœë‹¤
```text
í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸ êµ¬ì¶•
ìš”ì²­í•œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ê²€ìƒ‰ì„ ì‹œì‘í•˜ëŠ” ì¤‘
========== í…ŒìŠ¤íŠ¸ ê²€ìƒ‰ì„ ì‹œì‘í•˜ëŠ” ì¤‘ ==========
[xUnit.net 00:00:00.00] xUnit.net VSTest Adapter v3.1.5+1b188a7b0a (64-bit .NET 8.0.21)
[xUnit.net 00:00:00.07]   Discovering: ShipParticularsApi.Tests
[xUnit.net 00:00:00.10]   Discovered:  ShipParticularsApi.Tests
========== í…ŒìŠ¤íŠ¸ ê²€ìƒ‰ì´ ì™„ë£Œë¨: 1.5ì´ˆ ë™ì•ˆ í…ŒìŠ¤íŠ¸ 68ê°œë¥¼ ì°¾ìŒ ==========
========== í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì„ ì‹œì‘í•˜ëŠ” ì¤‘ ==========
[xUnit.net 00:00:00.00] xUnit.net VSTest Adapter v3.1.5+1b188a7b0a (64-bit .NET 8.0.21)
[xUnit.net 00:00:00.08]   Starting:    ShipParticularsApi.Tests
[testcontainers.org 00:00:00.11] Connected to Docker:
  Host: npipe://./pipe/docker_engine
  Server Version: 28.5.1
  Kernel Version: 6.6.87.2-microsoft-standard-WSL2
  API Version: 1.51
  Operating System: Docker Desktop
  Total Memory: 15.41 GB
  Labels: 
    com.docker.desktop.address=npipe://\\.\pipe\docker_cli
[testcontainers.org 00:00:00.23] Docker container 430fc19985e1 created
[testcontainers.org 00:00:00.27] Start Docker container 430fc19985e1
[testcontainers.org 00:00:00.50] Wait for Docker container 430fc19985e1 to complete readiness checks
[testcontainers.org 00:00:00.51] Docker container 430fc19985e1 ready
[testcontainers.org 00:00:02.59] Docker container a206269925ea created
[testcontainers.org 00:00:02.60] Start Docker container a206269925ea
[testcontainers.org 00:00:02.76] Wait for Docker container a206269925ea to complete readiness checks
[testcontainers.org 00:00:02.77] Execute "/bin/sh -c find /opt/mssql-tools*/bin/sqlcmd -type f -print -quit" at Docker container a206269925ea
[testcontainers.org 00:00:02.87] Execute "/opt/mssql-tools18/bin/sqlcmd -C -Q SELECT 1;" at Docker container a206269925ea
[testcontainers.org 00:00:07.47] Docker container a206269925ea ready
     Warning:
     The component "Fluent Assertions" is governed by the rules defined in the Xceed License Agreement and
     the Xceed Fluent Assertions Community License. You may use Fluent Assertions free of charge for
     non-commercial use only. An active subscription is required to use Fluent Assertions for commercial use.
     Please contact Xceed Sales mailto:sales@xceed.com to acquire a subscription at a very low cost.
     A paid commercial license supports the development and continued increasing support of
     Fluent Assertions users under both commercial and community licenses. Help us
     keep Fluent Assertions at the forefront of unit testing.
     For more information, visit https://xceed.com/products/unit-testing/fluent-assertions/
[testcontainers.org 00:00:08.65] Stop Docker container a206269925ea
[testcontainers.org 00:00:10.01] Docker container e3fb68425d2f created
[testcontainers.org 00:00:10.02] Start Docker container e3fb68425d2f
[testcontainers.org 00:00:10.21] Wait for Docker container e3fb68425d2f to complete readiness checks
[testcontainers.org 00:00:10.23] Execute "/bin/sh -c find /opt/mssql-tools*/bin/sqlcmd -type f -print -quit" at Docker container e3fb68425d2f
[testcontainers.org 00:00:10.31] Execute "/opt/mssql-tools18/bin/sqlcmd -C -Q SELECT 1;" at Docker container e3fb68425d2f
[testcontainers.org 00:00:13.91] Docker container e3fb68425d2f ready
[testcontainers.org 00:00:14.13] Stop Docker container e3fb68425d2f
[testcontainers.org 00:00:15.48] Docker container 35bf95e6859a created
[testcontainers.org 00:00:15.49] Start Docker container 35bf95e6859a
[testcontainers.org 00:00:15.71] Wait for Docker container 35bf95e6859a to complete readiness checks
[testcontainers.org 00:00:15.72] Execute "/bin/sh -c find /opt/mssql-tools*/bin/sqlcmd -type f -print -quit" at Docker container 35bf95e6859a
[testcontainers.org 00:00:15.83] Execute "/opt/mssql-tools18/bin/sqlcmd -C -Q SELECT 1;" at Docker container 35bf95e6859a
[testcontainers.org 00:00:19.43] Docker container 35bf95e6859a ready
[testcontainers.org 00:00:19.81] Stop Docker container 35bf95e6859a
[testcontainers.org 00:00:21.23] Docker container f874f11bde11 created
[testcontainers.org 00:00:21.24] Start Docker container f874f11bde11
[testcontainers.org 00:00:21.42] Wait for Docker container f874f11bde11 to complete readiness checks
[testcontainers.org 00:00:21.43] Execute "/bin/sh -c find /opt/mssql-tools*/bin/sqlcmd -type f -print -quit" at Docker container f874f11bde11
[testcontainers.org 00:00:21.50] Execute "/opt/mssql-tools18/bin/sqlcmd -C -Q SELECT 1;" at Docker container f874f11bde11
[testcontainers.org 00:00:25.08] Docker container f874f11bde11 ready
[testcontainers.org 00:00:25.32] Stop Docker container f874f11bde11
[xUnit.net 00:00:26.86]   Finished:    ShipParticularsApi.Tests
========== í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì´ ì™„ë£Œë¨: 26.9ì´ˆ ë™ì•ˆ í…ŒìŠ¤íŠ¸ 4ê°œê°€ ì‹¤í–‰ë¨(4ê°œ í†µê³¼, 0ê°œ ì‹¤íŒ¨, 0ê°œ ê±´ë„ˆëœ€) ==========

```



### íŠ¸ëŸ¬ë¸” ìŠˆíŒ…1
ì»¨í…Œì´ë„ˆ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì‹œ Repository í…ŒìŠ¤íŠ¸ë¥¼ ê·¸ëŒ€ë¡œ ë³µì‚¬í•´ì„œ ìˆ˜í–‰í–ˆëŠ”ë° 4ê°œì¤‘ 3ê°œê°€ ì‹¤íŒ¨í•¨
```text
[xUnit.net 00:00:10.05]       Microsoft.EntityFrameworkCore.DbUpdateException : An error occurred while saving the entity changes. See the inner exception for details.

[xUnit.net 00:00:10.05]       ---- Microsoft.Data.SqlClient.SqlException : Cannot insert explicit value for identity column in table 'SHIP_INFO' when IDENTITY_INSERT is set to OFF.
```


**ğŸš¨ ì˜¤ë¥˜ ì›ì¸ ë¶„ì„: IDENTITY_INSERT(Gemini)**
ë¡œê·¸ì— ëª…í™•í•˜ê²Œ ë‚˜ì™€ ìˆëŠ” SqlException ë©”ì‹œì§€ê°€ ë¬¸ì œì˜ ì›ì¸ì…ë‹ˆë‹¤.

Cannot insert explicit value for identity column in table 'SHIP_INFO' when IDENTITY_INSERT is set to OFF.

ë¬¸ì œ: í…Œì´ë¸” SHIP_INFOì— ID (ê¸°ë³¸ í‚¤) ì»¬ëŸ¼ì´ SQL Serverì—ì„œ ìë™ ì¦ê°€(Identity) ì†ì„±ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

ë°œìƒ ì‹œì : í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ DbContext.Add()ë¥¼ í˜¸ì¶œí•˜ì—¬ ì—”í„°í‹°ë¥¼ ì‚½ì…í•  ë•Œ, ì—”í„°í‹°ì— ID ê°’ì„ ì§ì ‘ ì§€ì •í–ˆê¸° ë•Œë¬¸ì— SQL Serverê°€ ì´ë¥¼ ê±°ë¶€í•œ ê²ƒì…ë‹ˆë‹¤.

ì¸ë©”ëª¨ë¦¬ SQLite í™˜ê²½ì—ì„œëŠ” ìë™ ì¦ê°€ ì„¤ì •ì´ ëŠìŠ¨í•˜ê²Œ ì²˜ë¦¬ë˜ê±°ë‚˜ ì•„ì˜ˆ ë¬´ì‹œë˜ì—ˆì„ ìˆ˜ ìˆì§€ë§Œ, Testcontainersë¥¼ ì‚¬ìš©í•˜ëŠ” ì‹¤ì œ SQL Server ì¸ìŠ¤í„´ìŠ¤ëŠ” ì´ ì œì•½ì„ ì—„ê²©í•˜ê²Œ ì ìš©í•©ë‹ˆë‹¤.


âœ… í•´ê²° : Test Fixtureì—ì„œ ID ê°’ì„ ì‚­ì œ

### íŠ¸ëŸ¬ë¸” ìŠˆíŒ…2

```text
Microsoft.EntityFrameworkCore.DbUpdateException : An error occurred while saving the entity changes. See the inner exception for details.

---- Microsoft.Data.SqlClient.SqlException : String or binary data would be truncated in table 'master.dbo.SHIP_INFO', column 'SHIP_KEY'. Truncated value: 'UNIQUE_SHI'.
```


- **ë¬¸ì œ:** ì—”í„°í‹° `SHIP_INFO`ì˜ **`SHIP_KEY`** ì»¬ëŸ¼ì— ì €ì¥í•˜ë ¤ëŠ” ë¬¸ìì—´ ê°’ì´ **ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì— ì„¤ì •ëœ ìµœëŒ€ ê¸¸ì´**ë¥¼ ì´ˆê³¼í–ˆê¸° ë•Œë¬¸ì— SQL Serverê°€ ì €ì¥ì„ ê±°ë¶€í•œ ê²ƒì…ë‹ˆë‹¤.
    
- **ë°œìƒ ì´ìœ :** ê¸°ì¡´ì— ì‚¬ìš©í•˜ì‹œë˜ **ì¸ë©”ëª¨ë¦¬ SQLite**ëŠ” ë¬¸ìì—´ ê¸¸ì´ ì œí•œì— ëŒ€í•´ ë§¤ìš° ê´€ëŒ€í•˜ê±°ë‚˜ ì•„ì˜ˆ ë¬´ì‹œí•©ë‹ˆë‹¤. í•˜ì§€ë§Œ **Testcontainersì˜ SQL Server**ëŠ” í”„ë¡œë•ì…˜ í™˜ê²½ì²˜ëŸ¼ **`NVARCHAR(50)`**ê³¼ ê°™ì€ ê¸¸ì´ë¥¼ ì—„ê²©í•˜ê²Œ ì²´í¬í•©ë‹ˆë‹¤.

âœ… í•´ê²° : ShipKey ë¬¸ìì—´ ê¸¸ì´ ìˆ˜ì •í•˜ì—¬ í…ŒìŠ¤íŠ¸ 4ê°œ í†µê³¼


ğŸ¤” SQLiteë¡œ í…ŒìŠ¤íŠ¸í• ë•ŒëŠ” í†µê³¼í•˜ë˜ê²Œ MSSQL ì»¨í…Œì´ë„ˆ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ì‹¤íŒ¨í•˜ëŠ”ê°€?

|**íŠ¹ì§•**|**SQLite (ì¸ë©”ëª¨ë¦¬)**|**SQL Server (Testcontainers)**|
|---|---|---|
|**ë°ì´í„° íƒ€ì… ê²€ì‚¬**|**ë§¤ìš° ëŠìŠ¨í•¨** (ìœ ì—°í•¨)|**ë§¤ìš° ì—„ê²©í•¨**|
|**ë¬¸ìì—´ ê¸¸ì´ ì œí•œ**|`VARCHAR`, `NVARCHAR` ê¸¸ì´ ì œí•œì„ **ë¬´ì‹œ**í•˜ê±°ë‚˜ **ì ìš©í•˜ì§€ ì•ŠìŒ**.|`NVARCHAR(N)`ì— ëª…ì‹œëœ ê¸¸ì´ë¥¼ **ì—„ê²©í•˜ê²Œ ì ìš©**. (ğŸ‘‰ `Truncation` ì˜¤ë¥˜ ë°œìƒ ì›ì¸)|
|**ìë™ ì¦ê°€(Identity)**|ì„¤ì •ì´ ì—†ì–´ë„ IDë¥¼ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²½ìš°ê°€ ë§ìŒ.|`IDENTITY_INSERT` ì„¤ì •ì´ êº¼ì ¸ ìˆìœ¼ë©´ **ëª…ì‹œì ì¸ ID ì‚½ì…ì„ ì—„ê²©í•˜ê²Œ ê±°ë¶€**. (ğŸ‘‰ `DbUpdateException` ì˜¤ë¥˜ ë°œìƒ ì›ì¸)|
|**íŠ¸ëœì­ì…˜/ì ê¸ˆ**|ë‹¨ì¼ íŒŒì¼ ê¸°ë°˜ì´ë¼ ë³µì¡í•œ ë™ì‹œì„± ì²˜ë¦¬ ë¡œì§ì´ ë‹¨ìˆœí•¨.|ì‹¤ì œ ë‹¤ì¤‘ ì‚¬ìš©ì í™˜ê²½ì˜ ë³µì¡í•œ ì ê¸ˆ/íŠ¸ëœì­ì…˜ ê´€ë¦¬ê°€ ë™ì‘í•¨.|

**ğŸš¨ ë°œìƒí•œ ë‘ ê°€ì§€ ì˜¤ë¥˜ì˜ ê·¼ë³¸ ì›ì¸ ìš”ì•½**

ì‚¬ìš©ìë‹˜ê»˜ì„œ ê²ªìœ¼ì‹  ë‘ ê°€ì§€ ì˜¤ë¥˜ëŠ” ëª¨ë‘ **"ì‹¤ì œ DBì˜ ì—„ê²©í•œ ì œì•½"** ë•Œë¬¸ì— ë°œìƒí•œ ê²ƒì…ë‹ˆë‹¤.

1. **`IDENTITY_INSERT` ì˜¤ë¥˜:** (ì´ì „ ë¬¸ì œ)
    - **ì›ì¸:** SQLiteëŠ” ê´€ëŒ€í–ˆì§€ë§Œ, SQL ServerëŠ” ID ì»¬ëŸ¼ì— **ê°œë°œìê°€ ê°’ì„ í• ë‹¹í•˜ëŠ” ê²ƒ**ì„ í—ˆìš©í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
    - **ì¡°ì¹˜:** ì—”í„°í‹°ë¥¼ ì‚½ì…í•  ë•Œ `Id = ...` ì½”ë“œë¥¼ ì œê±°í–ˆìŠµë‹ˆë‹¤.
        
2. **`Data Truncation` (ë°ì´í„° ì˜ë¦¼) ì˜¤ë¥˜:** (ê°€ì¥ ìµœê·¼ ë¬¸ì œ)
    - **ì›ì¸:** SQLiteëŠ” ê´€ëŒ€í–ˆì§€ë§Œ, SQL ServerëŠ” `SHIP_KEY` ì»¬ëŸ¼ì˜ **ê¸¸ì´ ì œí•œ**ì„ ì—„ê²©í•˜ê²Œ ì ìš©í–ˆìŠµë‹ˆë‹¤.
    - **ì¡°ì¹˜:** `SHIP_KEY`ì— í• ë‹¹í•˜ëŠ” ë¬¸ìì—´ì˜ ê¸¸ì´ë¥¼ DB ìŠ¤í‚¤ë§ˆì— ë§ê²Œ ì¤„ì—¬ì•¼ í•©ë‹ˆë‹¤.


### ê³ ë¯¼ 
`@DataJpaTest`ì˜ ê²½ìš° ê° í…ŒìŠ¤íŠ¸ ë©”ì„œë“œë§ˆë‹¤ íŠ¸ëœì­ì…˜ ë¡¤ë°±ì„ ì§€ì›í•œë‹¤. 
- [DataJpaTest (Spring Boot 3.5.7 API)](https://docs.spring.io/spring-boot/api/java/org/springframework/boot/test/autoconfigure/orm/jpa/DataJpaTest.html)

ê·¸ëŸ°ë° í˜„ì¬ ë‚´ê°€ í•˜ê³  ìˆëŠ” Repositoryì˜ ê²½ìš° ì»¨í…Œì´ë„ˆë¥¼ ì‹œì‘/ì¢…ë£Œí•˜ê¸° ë•Œë¬¸ì— íŠ¹ë³„íˆ íŠ¸ëœì­ì…˜ì„ ì‹¤í–‰í•˜ê±°ë‚˜ ë¡¤ë°±í•˜ì§€ ì•Šê³  ìˆë‹¤.(ëª…ì‹œì ìœ¼ë¡œ)

SaveChangeAsync() í†µí•´ ë¬µì‹œì ìœ¼ë¡œ íŠ¸ëœì­ì…˜ì„ ë³´ë‚´ëŠ”ë° .. ì „ì—­ ë³€ìˆ˜ë¡œ contextì™€ transactionì„ ë½‘ì•„ì„œ ê´€ë¦¬í•˜ëŠ”ê²Œ ë§ëŠ”ì§€ í…ŒìŠ¤íŠ¸ ë©”ì„œë“œë§ˆë‹¤ ê°œë³„ì ìœ¼ë¡œ íŠ¸ëœì­ì…˜ ê´€ë¦¬í•´ì£¼ëŠ”ê²Œ ë§ëŠ”ì§€ ê³ ë¯¼ ğŸ¤”


`ë¦¬íŒ©í„°ë§ ì „`
```cs
public class DatabaseContainerPerTestcs(ITestOutputHelper output)
    : IAsyncLifetime
{
    private readonly MsSqlContainer _dbContainer = new MsSqlBuilder()
        .WithImage("mcr.microsoft.com/mssql/server:2022-latest")
        .WithPassword("qwer1234!@#$")
        .WithCleanUp(true)
        .Build();

    private DbContextOptions<ShipParticularsContext> _options;

    private ShipParticularsContext _context;
    private IDbContextTransaction _transaction;

    private ShipParticularsContext CreateContext() => new(_options);

    [Fact(DisplayName = "DBì—ì„œ ì¡°íšŒí•œ ì—”í‹°í‹°ëŠ” DbContextê°€ ìƒíƒœ ì¶”ì  í•œë‹¤.")]
    public async Task AsTracking()
    {
        // Arrange
        const string shipKey = "SHIP_KEY";

        _context.ShipInfos.Add(NoService(shipKey).Build());
        await _context.SaveChangesAsync();

        // Act & Assert
        var repository = new ShipInfoRepository(_context);
        var actual = await repository.GetByShipKeyAsync(shipKey);

        actual.Should().NotBeNull();

        var entry = _context.Entry(actual!);
        entry.State.Should().Be(EntityState.Unchanged);
    }

    [Fact(DisplayName = "AsNoTracking()ìœ¼ë¡œ ì¡°íšŒí•œ ì—”í‹°í‹°ëŠ” ìƒíƒœì¶”ì í•˜ì§€ ì•ŠëŠ”ë‹¤.")]
    public async Task AsNoTracking()
    {
        // Arrange
        const string shipKey = "SHIP_KEY";

        _context.ShipInfos.Add(NoService(shipKey).Build());
        await _context.SaveChangesAsync();

        // Act & Assert
        var repository = new ShipInfoRepository(_context);
        var actual = await repository.GetReadOnlyByShipKeyAsync(shipKey);

        actual.Should().NotBeNull();

        var entry = _context.Entry(actual!);
        entry.State.Should().Be(EntityState.Detached);
    }

    [Fact(DisplayName = "shipKeyì— í•´ë‹¹í•˜ëŠ” ì„ ë°• ì •ë³´ê°€ ìˆìœ¼ë©´ trueë¥¼ ë°˜í™˜í•œë‹¤")]
    public async Task ExistsByShipKeyAsync()
    {
        // Arrange
        const string shipKey = "SHIP_KEY";

        _context.ShipInfos.Add(NoService(shipKey).Build());
        await _context.SaveChangesAsync();

        // Act & Assert
        var repository = new ShipInfoRepository(_context);
        bool actual = await repository.ExistsByShipKeyAsync(shipKey);

        actual.Should().BeTrue();
    }

    [Fact(DisplayName = "shipKeyì— í•´ë‹¹í•˜ëŠ” ì„ ë°• ì •ë³´ê°€ ì—†ìœ¼ë©´ falseë¥¼ ë°˜í™˜í•œë‹¤")]
    public async Task None_ExistsByShipKeyAsync()
    {
        var repository = new ShipInfoRepository(_context);

        bool actual = await repository.ExistsByShipKeyAsync("SHIP_KEY");

        actual.Should().BeFalse();
    }

    public async Task DisposeAsync()
    {
        if (_transaction != null)
        {
            await _transaction.RollbackAsync();
            await _transaction.DisposeAsync();
        }
        await _context.DisposeAsync();
        await _dbContainer.StopAsync();
    }

    public async Task InitializeAsync()
    {
        await _dbContainer.StartAsync();

        _options = new DbContextOptionsBuilder<ShipParticularsContext>()
                       .UseSqlServer(_dbContainer.GetConnectionString())
                       .UseLazyLoadingProxies()
                       .Options;

        _context = new ShipParticularsContext(_options);
        _context.Database.Migrate();

        _transaction = await _context.Database.BeginTransactionAsync();
    }
}
```


```cs
public class DatabaseContainerPerTestcs(ITestOutputHelper output)
    : IAsyncLifetime
{
    private readonly MsSqlContainer _dbContainer = new MsSqlBuilder()
        .WithImage("mcr.microsoft.com/mssql/server:2022-latest")
        .WithPassword("qwer1234!@#$")
        .WithCleanUp(true)
        .Build();

    private DbContextOptions<ShipParticularsContext> _options;

    private ShipParticularsContext CreateContext() => new(_options);

    [Fact(DisplayName = "DBì—ì„œ ì¡°íšŒí•œ ì—”í‹°í‹°ëŠ” DbContextê°€ ìƒíƒœ ì¶”ì  í•œë‹¤.")]
    public async Task AsTracking()
    {
        // Arrange
        await using var context = CreateContext();
        await using var transaction = await context.Database.BeginTransactionAsync();

        const string shipKey = "SHIP_KEY";

        context.ShipInfos.Add(NoService(shipKey).Build());
        await context.SaveChangesAsync();

        // Act & Assert
        var repository = new ShipInfoRepository(context);
        var actual = await repository.GetByShipKeyAsync(shipKey);

        actual.Should().NotBeNull();

        var entry = context.Entry(actual!);
        entry.State.Should().Be(EntityState.Unchanged);

        // ğŸŒŸ await using ë¸”ë¡ ì¢…ë£Œ ì‹œ, transactionì´ ë¡¤ë°±ë˜ì–´ ë°ì´í„° ìë™ ì •ë¦¬.
    }

    [Fact(DisplayName = "AsNoTracking()ìœ¼ë¡œ ì¡°íšŒí•œ ì—”í‹°í‹°ëŠ” ìƒíƒœì¶”ì í•˜ì§€ ì•ŠëŠ”ë‹¤.")]
    public async Task AsNoTracking()
    {
        // Arrange
        await using var context = CreateContext();
        await using var transaction = await context.Database.BeginTransactionAsync();

        const string shipKey = "SHIP_KEY";

        context.ShipInfos.Add(NoService(shipKey).Build());
        await context.SaveChangesAsync();

        // Act & Assert
        var repository = new ShipInfoRepository(context);
        var actual = await repository.GetReadOnlyByShipKeyAsync(shipKey);

        actual.Should().NotBeNull();

        var entry = context.Entry(actual!);
        entry.State.Should().Be(EntityState.Detached);
    }

    [Fact(DisplayName = "shipKeyì— í•´ë‹¹í•˜ëŠ” ì„ ë°• ì •ë³´ê°€ ìˆìœ¼ë©´ trueë¥¼ ë°˜í™˜í•œë‹¤")]
    public async Task ExistsByShipKeyAsync()
    {
        // Arrange
        await using var context = CreateContext();
        await using var transaction = await context.Database.BeginTransactionAsync();

        const string shipKey = "SHIP_KEY";

        context.ShipInfos.Add(NoService(shipKey).Build());
        await context.SaveChangesAsync();

        // Act & Assert
        var repository = new ShipInfoRepository(context);
        bool actual = await repository.ExistsByShipKeyAsync(shipKey);

        actual.Should().BeTrue();
    }

    [Fact(DisplayName = "shipKeyì— í•´ë‹¹í•˜ëŠ” ì„ ë°• ì •ë³´ê°€ ì—†ìœ¼ë©´ falseë¥¼ ë°˜í™˜í•œë‹¤")]
    public async Task None_ExistsByShipKeyAsync()
    {
        await using var context = CreateContext();
        await using var transaction = await context.Database.BeginTransactionAsync();

        var repository = new ShipInfoRepository(context);

        bool actual = await repository.ExistsByShipKeyAsync("SHIP_KEY");

        actual.Should().BeFalse();
    }

    public async Task DisposeAsync()
    {
        await _dbContainer.StopAsync();
    }

    public async Task InitializeAsync()
    {
        await _dbContainer.StartAsync();

        _options = new DbContextOptionsBuilder<ShipParticularsContext>()
                       .UseSqlServer(_dbContainer.GetConnectionString())
                       .UseLazyLoadingProxies()
                       .Options;

        var context = new ShipParticularsContext(_options);
        context.Database.Migrate();
    }
```


### ë¹„ë™ê¸° using ì„ ì–¸ (Asynchronous Using Declaration)
- ì´ë¥¼ í†µí•´ `ë¦¬ì†ŒìŠ¤ ìŠ¤ì½”í”„ ê´€ë¦¬` ë˜ëŠ” `ê°ì²´ ìˆ˜ëª… ì£¼ê¸° ê´€ë¦¬ íŒ¨í„´`ì´ë¼ê³  ì§€ì¹­


ğŸ’¡ ì´ íŒ¨í„´ì˜ ì—­í• ê³¼ ì´ì  (Repository í…ŒìŠ¤íŠ¸ì—ì„œì˜ ì˜ë¯¸)
ì´ íŒ¨í„´ì€ íŠ¹íˆ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ í…ŒìŠ¤íŠ¸ì—ì„œ ë‘ ê°€ì§€ ì¤‘ìš”í•œ ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

1. ì•ˆì „í•œ ë¹„ë™ê¸° ë¦¬ì†ŒìŠ¤ ì •ë¦¬ (IAsyncDisposable êµ¬í˜„)
ë°°ê²½: DbContextë‚˜ IDbContextTransactionê³¼ ê°™ì€ DB ê´€ë ¨ ë¦¬ì†ŒìŠ¤ëŠ” **ë¹„ë™ê¸°(Asynchronous)**ë¡œ ì •ë¦¬(Dispose)ë˜ì–´ì•¼ í•  ë¡œì§(ì˜ˆ: ë¹„ë™ê¸° íŠ¸ëœì­ì…˜ ë¡¤ë°±, ë¹„ë™ê¸° ì—°ê²° í•´ì œ)ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.

ì—­í• : await using ë¸”ë¡ì´ ì¢…ë£Œë˜ë©´, C# ì»´íŒŒì¼ëŸ¬ëŠ” ìë™ìœ¼ë¡œ ê°ì²´ì˜ DisposeAsync() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

ì½”ë“œ ì˜ë¯¸: "ì´ ë¸”ë¡ì´ ëë‚˜ë©´ arrangeContext ê°ì²´ë¥¼ **ë¹„ë™ê¸°ì ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ì •ë¦¬(Clean up)**í•˜ë¼."

2. ê²©ë¦¬ëœ ìŠ¤ì½”í”„ ë³´ì¥ (Separate Context for Arrange)
ë°°ê²½: í†µí•© í…ŒìŠ¤íŠ¸ì—ì„œ ë°ì´í„°ë¥¼ ì¤€ë¹„(Arrange)í•˜ëŠ” í–‰ìœ„ì™€ ì‹¤ì œë¡œ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ Repositoryë¥¼ ì‹¤í–‰(Act)í•˜ëŠ” í–‰ìœ„ëŠ” ì„œë¡œ ë‹¤ë¥¸ DbContext ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì´ë£¨ì–´ì ¸ì•¼ ì™„ë²½í•œ ê²©ë¦¬ê°€ ë³´ì¥ë©ë‹ˆë‹¤.

ì—­í• : arrangeContextëŠ” ì˜¤ì§ ë°ì´í„°ë¥¼ ì‚½ì…í•˜ê³  ì €ì¥í•˜ëŠ” ì—­í• ë§Œ ìˆ˜í–‰í•˜ë©°, ë¸”ë¡ì´ ëë‚˜ë©´ ì¦‰ì‹œ ì •ë¦¬ë˜ì–´ Act ë‹¨ê³„ì˜ DbContextì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.


```cs
// Arrange (ë°ì´í„° ì‚½ì…)
await using (var arrangeContext = CreateContext())
{
    // 1. ë°ì´í„°ë¥¼ ì‚½ì…í•˜ê³  ì»¤ë°‹ (Act Contextì™€ ë¶„ë¦¬ëœ Context ì‚¬ìš©)
    arrangeContext.ShipInfos.Add(/* ... */);
    await arrangeContext.SaveChangesAsync();
} // arrangeContextëŠ” ì—¬ê¸°ì„œ ì •ë¦¬ë¨

// Act (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
await using (var actContext = CreateContext())
{
    var repository = new ShipInfoRepository(actContext);
    // 2. ìƒˆë¡œìš´ actContextë¥¼ ì‚¬ìš©í•˜ì—¬ Repositoryë¥¼ í…ŒìŠ¤íŠ¸
    // arrangeContextê°€ ì •ë¦¬ë˜ì—ˆìœ¼ë¯€ë¡œ Actì— ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•ŠìŒ
}
```

ê²°ë¡ ì ìœ¼ë¡œ, ì´ íŒ¨í„´ì€ í†µí•© í…ŒìŠ¤íŠ¸ì—ì„œ í•„ìˆ˜ì ì¸ "ê²©ë¦¬ëœ ë°ì´í„° ì¤€ë¹„"ì™€ "ë¹„ë™ê¸° ë¦¬ì†ŒìŠ¤ì˜ ì•ˆì „í•œ ì •ë¦¬"ë¥¼ C# ë¬¸ë²•ì„ í†µí•´ ê°€ì¥ ìš°ì•„í•˜ê²Œ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.


### í…ŒìŠ¤íŠ¸ skip ë°©ë²• 
[c# - Skipping a whole test class in xUnit.net - Stack Overflow](https://stackoverflow.com/questions/14840172/skipping-a-whole-test-class-in-xunit-net)

> í´ë˜ìŠ¤ ë ˆë²¨ì—ì„œ skip í•˜ëŠ” ê²ƒì€ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤
> ë©”íƒ€ë¥¼ í‘œê¸°í•´ë‘ê³  dotnet cli ë¡œ ì‹¤í–‰ì‹œ ì œì™¸í•˜ëŠ” ë°©ë²• ìˆë‹¤ëŠ”ë° .. ë²ˆê±°ë¡œì›€


### Container-per-class Strategy 


ğŸ¤” í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì‹œ ì»¨í…Œì´ë„ˆ ì‹œì‘ ë¡œê·¸ê°€ ë‘ë²ˆ ì°íŒë‹¤.
```text
[testcontainers.org 00:00:00.22] Docker container 89e57ca4675e created
[testcontainers.org 00:00:00.25] Start Docker container 89e57ca4675e
[testcontainers.org 00:00:00.43] Wait for Docker container 89e57ca4675e to complete readiness checks
[testcontainers.org 00:00:00.44] Docker container 89e57ca4675e ready
[testcontainers.org 00:00:02.52] Docker container 2810f21daa19 created
[testcontainers.org 00:00:02.53] Start Docker container 2810f21daa19
```

ğŸ¤–`Gemini`
ì•„, í¥ë¯¸ë¡­ê³  ì¤‘ìš”í•œ í˜„ìƒì„ ë°œê²¬í•˜ì…¨ìŠµë‹ˆë‹¤\!

ë¶„ëª…íˆ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ í•˜ë‚˜ì—ì„œ `MsSqlContainer` ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ë§Œ ìƒì„±í•˜ê³  `IAsyncLifetime`ì„ êµ¬í˜„í–ˆëŠ”ë°, ë¡œê·¸ì—ëŠ” \*\*ë‘ ê°œì˜ Docker ì»¨í…Œì´ë„ˆê°€ ì‹œì‘(Start Docker container)\*\*ë˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì…ë‹ˆë‹¤.

ì´ëŠ” ì¼ë°˜ì ìœ¼ë¡œ **Testcontainersê°€ DB ì»¨í…Œì´ë„ˆë¥¼ ì‹œì‘í•˜ê¸° ìœ„í•´ ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë³´ì¡° ì»¨í…Œì´ë„ˆ** ë•Œë¬¸ì¼ ê°€ëŠ¥ì„±ì´ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤.


**ğŸ’¡ ë¡œê·¸ì— ë‘ ê°œì˜ ì»¨í…Œì´ë„ˆê°€ ë³´ì´ëŠ” ì´ìœ  (Ryukê³¼ Init ì»¨í…Œì´ë„ˆ)**

TestcontainersëŠ” ê°œë°œìê°€ ì§€ì •í•œ ì£¼ë ¥ ì»¨í…Œì´ë„ˆ(ì—¬ê¸°ì„œëŠ” SQL Server) ì™¸ì—ë„ í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ë³´ì¡° ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

1.  **ì£¼ë ¥ ì»¨í…Œì´ë„ˆ (SQL Server):**
      * ë¡œê·¸ì—ì„œ **ì˜¤ë˜ ì‹¤í–‰ë˜ê³  ì‹¤ì œë¡œ DB ì‘ì—…ì„ ìˆ˜í–‰**í•˜ëŠ” ì»¨í…Œì´ë„ˆì…ë‹ˆë‹¤. (ì˜ˆ: `89e57ca4675e`)
2.  **ë³´ì¡° ì»¨í…Œì´ë„ˆ (Ryuk ë˜ëŠ” Init):**
      * **Ryuk ì»¨í…Œì´ë„ˆ:** Testcontainersê°€ ì‹œì‘ë  ë•Œ, í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í›„ ì •ë¦¬ë˜ì§€ ì•Šì€ **ëª¨ë“  ì»¨í…Œì´ë„ˆì™€ ë³¼ë¥¨ì„ ì•ˆì „í•˜ê²Œ ì •ë¦¬**í•˜ê¸° ìœ„í•´ Testcontainers ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìë™ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ì‘ì€ ì»¨í…Œì´ë„ˆì…ë‹ˆë‹¤. ì´ëŠ” Testcontainersë¥¼ ì‚¬ìš©í•˜ëŠ” **ì„¸ì…˜ë‹¹ í•œ ë²ˆ**ë§Œ ì‹œì‘ë˜ë©°, í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ë„ ë°”ë¡œ ì¢…ë£Œë˜ì§€ ì•Šê³  ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.
      * **Init ì»¨í…Œì´ë„ˆ:** ë“œë¬¼ê²Œ, Testcontainersê°€ ë³µì¡í•œ ì´ˆê¸°í™”(ì˜ˆ: ë„¤íŠ¸ì›Œí¬ ì„¤ì •, ë¼ì´ì„ ìŠ¤ ì²´í¬)ë¥¼ ìœ„í•´ ì„ì‹œë¡œ ì»¨í…Œì´ë„ˆë¥¼ ì‹œì‘í•˜ê³  ì¦‰ì‹œ ì¢…ë£Œí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

**ì‚¬ìš©ìë‹˜ì˜ ë¡œê·¸ ë¶„ì„:**

```
[testcontainers.org 00:00:00.25] Start Docker container 89e57ca4675e // ğŸŒŸ 1. ì²« ë²ˆì§¸ ì»¨í…Œì´ë„ˆ ì‹œì‘
...
[testcontainers.org 00:00:02.53] Start Docker container 2810f21daa19 // ğŸŒŸ 2. ë‘ ë²ˆì§¸ ì»¨í…Œì´ë„ˆ ì‹œì‘
```

ì´ ë‘ ë²ˆì§¸ ì»¨í…Œì´ë„ˆ(`2810f21daa19`)ëŠ” ì•„ë§ˆë„ **Ryuk ì»¨í…Œì´ë„ˆ**ì¼ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤. ì´ ì»¨í…Œì´ë„ˆëŠ” DB ì‘ì—…ê³¼ëŠ” ë¬´ê´€í•˜ë©°, \*\*í…ŒìŠ¤íŠ¸ í™˜ê²½ì˜ ê±´ì „ì„±(Cleanup)\*\*ì„ ìœ„í•´ ì¡´ì¬í•©ë‹ˆë‹¤.

**âœ… ê²°ë¡ : ê±±ì •í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.**
  * í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ **`new MsSqlContainer()`ë¥¼ í•œ ë²ˆë§Œ í˜¸ì¶œ**í–ˆë‹¤ë©´, ì—¬ëŸ¬ë¶„ì˜ í…ŒìŠ¤íŠ¸ ë¡œì§ì— ì‚¬ìš©ë˜ëŠ” DB ì»¨í…Œì´ë„ˆëŠ” í•˜ë‚˜ì…ë‹ˆë‹¤.
  * ë‚˜ë¨¸ì§€ ì»¨í…Œì´ë„ˆëŠ” **Testcontainers ë¼ì´ë¸ŒëŸ¬ë¦¬ ìì²´ê°€ ì•ˆì •ì„±ì„ ìœ„í•´ ê´€ë¦¬**í•˜ëŠ” ë‚´ë¶€ ë„êµ¬ì´ë¯€ë¡œ, **í…ŒìŠ¤íŠ¸ ë¡œì§ì— ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**

**ğŸš€ ë‹¤ìŒ ë‹¨ê³„: ì„±ëŠ¥ ìµœì í™”ë¡œ ì „í™˜**

ì´ëŸ¬í•œ ë‚´ë¶€ ì»¨í…Œì´ë„ˆì˜ ì˜¤ë²„í—¤ë“œë¥¼ ì¤„ì¼ ìˆ˜ëŠ” ì—†ì§€ë§Œ, í…ŒìŠ¤íŠ¸ê°€ ëŠë ¤ì§€ëŠ” ì£¼ë²”ì¸ **SQL Server ì»¨í…Œì´ë„ˆì˜ ì¦ì€ ì‹œì‘/ì¢…ë£Œ**ëŠ” ë§‰ì•„ì•¼ í•©ë‹ˆë‹¤.

ì´ì œ ë…¼ì˜í–ˆë˜ ëŒ€ë¡œ **ì»¨í…Œì´ë„ˆë¥¼ ì†”ë£¨ì…˜ ì „ì²´ì—ì„œ ê³µìœ **í•˜ê³  í…ŒìŠ¤íŠ¸ ì†ë„ë¥¼ ë†’ì´ëŠ” `ICollectionFixture` íŒ¨í„´ìœ¼ë¡œ ì „í™˜í•˜ëŠ” ë¦¬íŒ©í† ë§ì„ ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤.

**âœ… ë‹¤ìŒ ë‹µë³€ì—ì„œ `ICollectionFixture`ë¥¼ ì‚¬ìš©í•œ 3ê°€ì§€ í´ë˜ìŠ¤ êµ¬ì¡°ë¥¼ ì œì‹œí•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.**


ğŸ¤” í•˜ë‚˜ì˜ í´ë˜ìŠ¤ ë‚´ì— ì»¨í…Œì´ë„ˆ í•˜ë‚˜ê°€ ê³µìœ ë˜ëŠ”ì§€ í™•ì‹¤íˆ ì•Œê³  ì‹¶ì–´ì„œ ì„ì˜ì˜ í…ŒìŠ¤íŠ¸ë¥¼ ë˜ ë§Œë“¦ 

```cs
public class DatabaseContainerPerTestClass2(DatabaseFixture fixture, ITestOutputHelper output)
    : IClassFixture<DatabaseFixture>, IDisposable
{
    public void Dispose()
    {
        output.WriteLine($"Container Id = {fixture.ContainerId}");
    }

    [Fact]
    public void SampleTest()
    {
        // Sample test implementation
        output.WriteLine("This is a sample test.");
    }
}
```

`ì¶œë ¥ ê²°ê³¼`
```text
// DatabaseContainerPerTestClass (4ê°œ í…ŒìŠ¤íŠ¸ ì „ë¶€ë‹¤)
Container Id = 2f80250e5cde7e727ce0c22ccc9a12157ce1d1c4f0a88684dfada00605ffa562

// DatabaseContainerPerTestClass2
Container Id = ad64d4ab8a6885846c1e09f053d6871e7e45ff4026692fac0aa2b67e556ba8d1
```
- í…ŒìŠ¤íŠ¸ ì „ì²´ ì‹¤í–‰ì‹œ ì»¨í…Œì´ë„ˆê°€ ë‹¤ë¥¸ ê²ƒì„ í™•ì¸í•¨


### IClassFixture


### Container-per-collection Strategy
- `[CollectionDefinition(..)]`ìœ¼ë¡œ ì„ ì–¸ 
	- ê°™ì€ ì»¨í…Œì´ë„ˆë¥¼ ê³µìœ í•  í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì—ì„œëŠ” í´ë˜ìŠ¤ ì‹œê·¸ë‹ˆì²˜ ìœ„ì— ë©”íƒ€ ì¶”ê°€ 
	- `[Collection(..)]`

ğŸ’© `[CollectionDefinition(nameof(DatabaseCollection))]`, `[Collection(nameof(DatabaseCollection))]` ìœ¼ë¡œ ì„¤ì •ì‹œ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ 3ê°œì˜ ì»¨í…Œì´ë„ˆ ì•„ì´ë””ê°€ ë‹¤ë¥¸ ì´ìŠˆ (251104)


**ğŸš¨ ì˜¤ë¥˜ ì›ì¸: `nameof()`ì™€ `ICollectionFixture`ì˜ í•´ì„ ì°¨ì´**
ë¬¸ì œëŠ” `[CollectionDefinition]`ì— ì¸ìë¡œ ì „ë‹¬í•˜ëŠ” **ë¬¸ìì—´**ì´ ì •í™•íˆ **ì¼ì¹˜**í•´ì•¼ xUnitì´ ë¦¬ì†ŒìŠ¤ë¥¼ ê³µìœ í•˜ëŠ”ë°, `nameof()`ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ì´ ì¼ì¹˜ì„±ì´ ê¹¨ì§„ ê²ƒì…ë‹ˆë‹¤.

1. `nameof(DatabaseCollection)` ì‚¬ìš© ì‹œ (ì˜¤ë¥˜ ë°œìƒ)
`nameof(DatabaseCollection)`ëŠ” ì»´íŒŒì¼ ì‹œì ì— í´ë˜ìŠ¤ ì´ë¦„ì¸ **"DatabaseCollection"** ì´ë¼ëŠ” ë¬¸ìì—´ ë¦¬í„°ëŸ´ë¡œ ì¹˜í™˜ë©ë‹ˆë‹¤.

```cs
// ğŸŒŸ CollectionDefinitionì˜ ì¸ìëŠ” ë¬¸ìì—´ ë¦¬í„°ëŸ´ "DatabaseCollection"
[CollectionDefinition(nameof(DatabaseCollection))] 
public class DatabaseCollection : ICollectionFixture<DatabaseFixture>;
```
ë¬¸ì œëŠ” **ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤**ì—ì„œ ì»¬ë ‰ì…˜ì„ ì°¸ì¡°í•  ë•Œ ë°œìƒí•©ë‹ˆë‹¤.

```cs
// ğŸŒŸ ì—¬ê¸°ì— ì‚¬ìš©ëœ "DatabaseCollection"ì€
//    nameof(DatabaseCollection)ì´ ì•„ë‹Œ, 'nameof(DatabaseCollection).GetType().Name'ìœ¼ë¡œ
//    í•´ì„ë˜ê±°ë‚˜, xUnitì˜ ë©”íƒ€ë°ì´í„° ë¡œë”ê°€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¾ì§€ ëª»í•˜ê³ 
//    ì»¬ë ‰ì…˜ ì´ë¦„ì´ ë‹¤ë¥¸ ê°’ìœ¼ë¡œ í•´ì„ë  ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.
//    (íŠ¹íˆ C# 9.0 ì´ìƒì˜ Record, Init-only setter ë“± ìƒˆë¡œìš´ êµ¬ë¬¸ê³¼ ì„ì¼ ë•Œ)
[Collection(nameof(DatabaseCollection))]
```

ê°€ì¥ í° ê°€ëŠ¥ì„±ì€: xUnitì´ nameof(T)ë¡œ ì •ì˜ëœ ì»¬ë ‰ì…˜ì„ ë¡œë“œí•  ë•Œ, ì»´íŒŒì¼ëŸ¬ê°€ ìƒì„±í•œ ì‹¬ë³¼ ì´ë¦„ì„ ì •í™•íˆ ë§¤ì¹­í•˜ì§€ ëª»í•˜ê³ , ì»¬ë ‰ì…˜ì´ ì •ì˜ë˜ì§€ ì•Šì•˜ë‹¤ê³  íŒë‹¨í•˜ì—¬ ê° í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ë§ˆë‹¤ ìƒˆ ì»¬ë ‰ì…˜ì„ ì„ì‹œë¡œ ìƒì„±í•´ ë²„ë ¸ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.



âœ… `nameof()`ë¡œ ì§€ì •í•˜ì§€ ì•Šê³  ì•„ë˜ì™€ ê°™ì´ **ë¬¸ìì—´** ê³ ì •í•˜ì—¬ ì‹¤í–‰í•œ ê²°ê³¼, í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ 3ê°œë‹¤ ê°™ì€ ì»¨í…Œì´ë„ˆ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ í™•ì¸í•¨
```cs
// ğŸŒŸ CollectionDefinitionì˜ ì¸ìê°€ ê³µë°±ì´ í¬í•¨ëœ ë¬¸ìì—´ ë¦¬í„°ëŸ´ "Database Collection"
[CollectionDefinition("Database Collection")] 
public class DatabaseCollection : ICollectionFixture<DatabaseFixture>;

// ğŸŒŸ Collectionì˜ ì¸ìë„ ì •í™•íˆ ë™ì¼í•œ ë¬¸ìì—´ ë¦¬í„°ëŸ´ "Database Collection"
[Collection("Database Collection")]
public class DatabaseContainerPerCollection(...)
```
ì´ ê²½ìš°ì—ëŠ” ì¸ìê°€ ë‹¨ìˆœí•œ **ë¬¸ìì—´ ë¦¬í„°ëŸ´**ë¡œ ì •í™•íˆ ì¼ì¹˜í•˜ë©°, xUnitì€ ë¬¸ìì—´ ë¹„êµë§Œìœ¼ë¡œ **"Database Collection"ì´ë¼ëŠ” ì´ë¦„ì˜ Fixture ì¸ìŠ¤í„´ìŠ¤ê°€ ì´ë¯¸ ì¡´ì¬í•œë‹¤"**ëŠ” ê²ƒì„ í™•ì‹¤í•˜ê²Œ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


```cs
[CollectionDefinition("Database Collection")]
public class DatabaseCollection : ICollectionFixture<DatabaseFixture>;

[Collection("Database Collection")]
public class DatabaseContainerPerCollection(DatabaseFixture fixture, ITestOutputHelper output)
    : IDisposable
{
    public void Dispose()
    {
        output.WriteLine($"Collection Container Id = {fixture.ContainerId}");
    }
 
	// í…ŒìŠ¤íŠ¸ ì½”ë“œ  
}
```


```cs
[Collection("Database Collection")]
public class DatabaseContainerPerCollection2(DatabaseFixture fixture, ITestOutputHelper output)
    : IDisposable
{
    public void Dispose()
    {
        output.WriteLine($"Collection Container Id = {fixture.ContainerId}");
    }
	 
	// í…ŒìŠ¤íŠ¸ ì½”ë“œ   
}

```


`ì½˜ì†” ì¶œë ¥`
```text
// DatabaseContainerPerCollection.cs
Collection Container Id = bcca2c060690020ef020a95be21e3402ebd2967b271b20e0be2b3468146734aa

// DatabaseContainerPerCollection2.cs
Collection Container Id = bcca2c060690020ef020a95be21e3402ebd2967b271b20e0be2b3468146734aa

//DatabaseContainerPerCollection3.cs
Collection Container Id = bcca2c060690020ef020a95be21e3402ebd2967b271b20e0be2b3468146734aa
```

> nameof(..)ê°€ í¸ë¦¬í•˜ê¸´ í•˜ì§€ë§Œ ì»´íŒŒì¼ ì‹œì ì— í´ë˜ìŠ¤ë§ˆë‹¤ ë‹¤ë¥´ê²Œ í•´ì„í•  ìˆ˜ ìˆë‹¤. ë‚´ ìƒê°ì— ì œíŠ¸ë¸Œë ˆì¸ ì˜ˆì‹œì˜ ê²½ìš° static class ì•ˆì— ë‘ ê°œì˜ í´ë˜ìŠ¤ë¥¼ ì„ ì–¸í•´ì„œ ì‘ì„±í•œ ì˜ˆì œì´ë‹¤ ë³´ë‹ˆ ì»´íŒŒì¼ ì‹œì ì— í†µì¼ë˜ì„œ ë¬¸ì œ ì—†ì´ ì‹¤í–‰ ëœ ê²ƒìœ¼ë¡œ ìƒê° ëœë‹¤.

**ğŸ“Œì°¸ê³ . ì œíŠ¸ë¸Œë ˆì¸ ë¬¸ì„œ** 
[How to use Testcontainers with .NET Unit Tests | The .NET Tools Blog](https://blog.jetbrains.com/dotnet/2023/10/24/how-to-use-testcontainers-with-dotnet-unit-tests/#container-per-collection-strategy)

> ShipInfoBaseRepositoryTestë¥¼ ì‘ì„±í–ˆëŠ”ë°.. ê¸°ì¡´ì— Testcontainers í…ŒìŠ¤íŠ¸ í•œê±°ë‘ ë˜‘ê°™ìŒ ê²°êµ­ ã…‹ã…‹ ì‚½ì§ˆë§Œ..... IAsyncLifetimeì€ í´ë˜ìŠ¤ ë‹¨ìœ„ë¡œ ìƒì„±/ì†Œë©¸ í•˜ë‹¤ë³´ë‹ˆ DbContextì™€ Transactionì„ ì—¬ê¸°ì„œ ê´€ë¦¬í•˜ê²Œ ë˜ë©´ ëª¨ë“  í…ŒìŠ¤íŠ¸ ë©”ì„œë“œê°€ ê°™ì€ íŠ¸ëœì­ì…˜ì„ ê³µìœ í•˜ê²Œ ë¨ => ê·¸ë˜ì„œ í…ŒìŠ¤íŠ¸ë©”ì„œë“œì—ì„œ context, transaction ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë‹¤ì‹œ ë³€ê²½

---

### ì„œë¹„ìŠ¤ ë ˆì´ì–´ í†µí•© í…ŒìŠ¤íŠ¸ì‹œ ì™¸ë¶€ íŠ¸ëœì­ì…˜ ë¡¤ë°± ì‹¤í–‰ì‹œ ì—ëŸ¬ ë°œìƒ

ì°¸ì—¬ í•œë‹¤ê³  ìƒê°í–ˆëŠ”ë° TransactionDecoratorì—ì„œ íŠ¸ëœì­ì…˜ ì‹œì‘ì‹œ ì—ëŸ¬ ë°œìƒ
> System.InvalidOperationException : The connection is already in a transaction and cannot participate in another transaction.

ë°©ë²•1. ..

ë°©ë²•2. ì™¸ë¶€ íŠ¸ëœì­ì…˜ ìƒì„±í•´ì„œ ê³µìœ  (ì•ˆë¨ x)

ë°©ë²•3. SQLite ì‚¬ìš©í•œ í†µí•©í…ŒìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©í•œ DbInit ë°©ì‹ (ì‹¤íŒ¨)

> Microsoft.Data.SqlClient.SqlException : Option 'SINGLE_USER' cannot be set in database 'master'.





---
### Reference
- [How to use Testcontainers with .NET Unit Tests | The .NET Tools Blog](https://blog.jetbrains.com/dotnet/2023/10/24/how-to-use-testcontainers-with-dotnet-unit-tests/)
- [Testing with xUnit.net - Testcontainers for .NET](https://dotnet.testcontainers.org/test_frameworks/xunit_net/)
- [How to Use TestContainers in .Net](https://www.freecodecamp.org/news/how-to-use-testcontainers-in-net/)
- [khalidabuhakmeh/TestingWithContainers: Using TestContainers.NET with Xunit for integration testing](https://github.com/khalidabuhakmeh/TestingWithContainers)
- [Sharing Context between Tests | xUnit.net](https://xunit.net/docs/shared-context)
	- xUnit ë²„ì „ì— ë”°ë¼ ìƒì„±ì ì´ˆê¸°í™”ì‹œ ë¹„ë™ê¸° ë©”ì„œë“œ í˜¸ì¶œì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤ëŠ” ë‚´ìš©ì„ ì–¸ê¸‰ 
		- íŠ¹íˆ v2ëŠ” ì•ˆë¨

