# 인수 테스트 가이드 문서  
  
## 1. 개요 및 목적  
  
이 문서는 `atdd-camping-tests` 프로젝트의 시스템 레벨 인수 테스트 작성 및 관리를 위한 가이드라인을 제공합니다. `kiosk`, `admin`, `reservation`, `payments` 서비스 간의 복합적인 상호작용을 검증하고, 서비스의 기능적 요구사항을 충족하는지 확인하는 것이 목표입니다. AI를 활용하여 효율적으로 시나리오를 생성하고 관리할 수 있도록 지원합니다.  
  
## 2. Gherkin 문법 및 Best Practice  
  
인수 테스트 시나리오는 Gherkin 문법(Given-When-Then)을 사용하여 작성됩니다. 이는 비즈니스 담당자와 개발자 간의 의사소통을 용이하게 하고, 테스트 케이스의 가독성을 높입니다.  
  
### 기본 구조  
  
```gherkin  
Feature: 기능 제목  
  설명 (선택 사항)  
  Scenario: 시나리오 제목    Given [전제 조건]    When [행동]    Then [기대 결과]  
  Scenario Outline: 시나리오 개요 (데이터 기반 테스트)    Given [전제 조건] <변수1>    When [행동] <변수2>    Then [기대 결과] <변수3>    Examples:      | 변수1 | 변수2 | 변수3 |      | 값1   | 값2   | 값3   |      | 값4   | 값5   | 값6   |```  
  
### Best Practices  
  
*   **단일 책임 원칙 (Single Responsibility Principle):** 각 시나리오는 하나의 비즈니스 규칙 또는 사용자 여정을 검증해야 합니다.  
*   **비즈니스 언어 사용:** 기술적인 세부 사항보다는 비즈니스 용어를 사용하여 모든 이해관계자가 이해할 수 있도록 작성합니다.  
*   **명확하고 간결하게:** `Given`, `When`, `Then` 각 절은 명확하고 간결하게 작성합니다.  
*   **Step 재사용:** 가능한 경우 기존 Step 정의를 재사용하여 중복을 줄이고 일관성을 유지합니다.  
  
## 3. 시나리오 작성 가이드라인  
  
효율적이고 견고한 인수 테스트 시나리오 작성을 위한 핵심 가이드라인은 다음과 같습니다. AI 생성 시나리오 또한 이 기준을 준수해야 합니다.  
  
### 3.1. 의도-검증 일치 (When/Then이 비즈니스 기대를 검증하는가)  
  
*   `When` 절에서 정의된 행동이 `Then` 절에서 검증하려는 비즈니스 기대와 직접적으로 연결되어야 합니다.  
*   **나쁜 예시:**  
    ```gherkin  
    Scenario: 불필요한 HTTP 상태 코드 검증  
      When 사용자가 예약 생성을 요청한다      Then 응답 코드가 200이다    ```    (200 OK는 단지 기술적인 성공을 의미하며, 비즈니스 관점에서 예약이 성공적으로 처리되었는지에 대한 충분한 검증이 아닙니다.)  
*   **좋은 예시:**  
    ```gherkin  
    Scenario: 예약 성공 시 비즈니스 기대 검증  
      When 사용자가 유효한 정보로 예약을 생성한다      Then 예약이 성공적으로 생성되고, 예약 상태가 'CONFIRMED'이다      And 재고가 1 감소한다    ```  
### 3.2. 환경 독립성 (호스트/포트/토큰 하드코딩 금지, 베이스 URL/시크릿 외부화)  
  
*   테스트는 특정 환경 설정에 의존해서는 안 됩니다.  
*   **나쁜 예시:**  
    ```gherkin  
    Scenario: 하드코딩된 URL 사용  
      Given 'http://localhost:8080/api/reservations'에 접근하여      When 예약을 생성한다      Then ...    ```*   **좋은 예시:**  
    ```gherkin  
    Scenario: 환경 변수/설정을 통한 접근  
      Given 예약 서비스에 접근하여      When 예약을 생성한다      Then ...    ```    (베이스 URL 등은 `config.properties` 또는 테스트 프레임워크 설정을 통해 관리되어야 합니다.)  
*   인증 토큰과 같은 민감 정보는 절대 시나리오 파일에 직접 포함하지 않고, 외부 설정 파일을 통해 관리합니다.  
  
### 3.3. 데이터 격리 (고유 네임스페이스, 재실행 안전)  
  
*   각 시나리오는 독립적으로 실행되어야 하며, 다른 시나리오의 실행에 영향을 주거나 받지 않아야 합니다.  
*   테스트 실행 시마다 고유한 데이터를 생성하거나, 테스트 후 데이터를 정리하여 재실행 안전성을 보장합니다.  
*   **좋은 예시:**  
    *   테스트 시작 시 무작위 문자열 또는 타임스탬프를 포함한 고유한 사용자/예약 ID를 생성합니다.  
    *   테스트 실행 후 생성된 데이터를 롤백하거나 삭제합니다. (예: `@After` 훅 사용)  
  
### 3.4. 관찰 가능성 (Reservation 상태, Admin 조회, WireMock 호출 기록 등)  
  
*   테스트 결과는 시스템의 여러 구성 요소에서 명확하게 관찰 가능해야 합니다.  
*   **예시:**  
    *   결제 성공 시: `Reservation` 서비스에서 예약 상태가 `CONFIRMED`로 변경되었는지 확인합니다.  
    *   재고 감소: `Admin` 서비스에서 해당 상품의 재고가 정확히 감소했는지 확인합니다.  
    *   결제 실패 시: WireMock의 호출 기록을 확인하여 `payments` 서비스에 적절한 요청이 전달되었는지 검증합니다.  
  
## 4. 태깅 전략 및 실행  
  
테스트 시나리오의 생명주기를 관리하고 선택적으로 실행하기 위해 태그를 사용합니다.  
  
*   **`@ai-candidate`:** AI가 새로 생성한 시나리오에 기본적으로 부여되는 태그입니다. 이 태그가 붙은 시나리오는 아직 검토 및 승인 대기 중임을 의미합니다.  
    *   **실행:** `./gradlew :atdd-tests:test -Dcucumber.filter.tags="@ai-candidate"`  
*   **`@e2e`:** 검토를 통과하고 시스템 레벨 인수 테스트로 승인된 시나리오에 부여되는 태그입니다. 실제 운영 환경과 유사한 환경에서 정기적으로 실행되어야 합니다.  
    *   **실행:** `./gradlew :atdd-tests:test -Dcucumber.filter.tags="@e2e"`  
*   **`@smoke`:** 가장 핵심적인 기능에 대한 빠른 검증을 위한 시나리오에 부여합니다.  
*   **`@payment-failure`:** 결제 실패와 관련된 시나리오에 부여합니다.  
  
AI 생성 시나리오가 검토 체크리스트를 통과하면 `@ai-candidate` 태그를 제거하고, 해당 시나리오의 목적에 맞는 태그(예: `@e2e`, `@payment-failure` 등)를 부여합니다.  
  
## 5. 테스트 실행 방법  
  
`atdd-camping-tests` 프로젝트는 Gradle을 사용하여 테스트를 실행합니다.  
  
```bash  
# 모든 인수 테스트 실행 (특별한 태그 필터링 없이)  
./gradlew :atdd-tests:test  
# 특정 태그를 가진 테스트 실행  
./gradlew :atdd-tests:test -Dcucumber.filter.tags="@e2e"  
  
# 여러 태그를 조합하여 테스트 실행 (AND 조건)  
./gradlew :atdd-tests:test -Dcucumber.filter.tags="@e2e and @smoke"  
  
# 여러 태그를 조합하여 테스트 실행 (OR 조건)  
./gradlew :atdd-tests:test -Dcucumber.filter.tags="@e2e or @smoke"  
  
# 특정 태그를 제외하고 테스트 실행  
./gradlew :atdd-tests:test -Dcucumber.filter.tags="not @deprecated"  
```  
  
## 6. AI 생성 시나리오 검토 체크리스트  
  
AI가 생성한 시나리오를 승인하기 전에 다음 체크리스트를 사용하여 검토해야 합니다. 이 체크리스트를 통과한 시나리오만 `@ai-candidate` 태그를 제거하고 적절한 다른 태그를 부여합니다.  
  
*   [ ] **의도-검증 일치:** `When` 절의 행동이 `Then` 절에서 비즈니스 기대를 정확히 검증하는가?  
*   [ ] **환경 독립성:** 호스트, 포트, 인증 토큰 등이 시나리오에 하드코딩되어 있지 않은가? 베이스 URL, 시크릿 등은 외부 설정으로 관리되는가?  
*   [ ] **데이터 격리:** 시나리오가 독립적으로 실행되며, 재실행 시에도 동일한 결과를 보장하는가? 테스트 데이터가 고유하게 생성되고 정리되는가?  
*   [ ] **관찰 가능성:** 테스트 결과가 예약 상태, 관리자 조회, WireMock 호출 기록 등 시스템의 여러 지점에서 명확하게 관찰 및 검증되는가?  
*   [ ] **가독성 및 이해도:** 시나리오가 비즈니스 언어로 명확하고 간결하게 작성되어 모든 이해관계자가 쉽게 이해할 수 있는가?  
*   [ ] **완전성:** 정상, 경계, 예외 시나리오를 적절히 포괄하고 있는가?